Table,Field,Code,QC Name,QC Description,Message,Expression,Type of QC,Level Error,Creation Mode,Status,Valid
"DisaggregatedData","monitoringSiteIdentifier","FC3","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","observedPropertyDeterminandCode","FC10","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","procedureAnalysedMatrix","FC12","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","phenomenonTimeSamplingDate","FC16","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","phenomenonTimeSamplingDate","FT17","Field type DATE","Checks if the field is a valid DATE","The value is not a valid date (YYYY-MM-DD)",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","sampleIdentifier","FC18","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","resultObservedValue","FT20","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid whole or decimal number",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","procedureLOQValue","FT25","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","parameterSampleDepth","FT26","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","resultMoisture","FT29","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","resultFat","FT30","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","resultExtractableLipid","FT31","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","resultLipid","FT32","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","monitoringSiteIdentifier","FC38","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","observedPropertyDeterminandCode","FC42","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","procedureAnalysedMatrix","FC44","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","phenomenonTimeReferenceYear","FC49","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","phenomenonTimeReferenceYear","FT50","Field type NUMBER - INTEGER","Checks if the field is a valid NUMBER - INTEGER","The value is not a valid integer number",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","procedureLOQValue","FT52","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","resultNumberOfSamples","FT53","Field type NUMBER - INTEGER","Checks if the field is a valid NUMBER - INTEGER","The value is not a valid integer number",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","resultNumberOfSamples","FC54","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","resultQualityNumberOfSamplesBelowLOQ","FT55","Field type NUMBER - INTEGER","Checks if the field is a valid NUMBER - INTEGER","The value is not a valid integer number",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","resultMinimumValue","FT57","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","resultMeanValue","FT62","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","resultMaximumValue","FT64","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","resultMedianValue","FT68","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","resultStandardDeviationValue","FT71","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","parameterSampleDepth","FT73","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","waterBodyIdentifier","FC77","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","observedPropertyDeterminandCode","FC82","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","procedureAnalysedMatrix","FC84","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","phenomenonTimeReferenceYear","FC88","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","phenomenonTimeReferenceYear","FT89","Field type NUMBER - INTEGER","Checks if the field is a valid NUMBER - INTEGER","The value is not a valid integer number",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","procedureLOQValue","FT91","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultNumberOfSamples","FC92","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultNumberOfSamples","FT93","Field type NUMBER - INTEGER","Checks if the field is a valid NUMBER - INTEGER","The value is not a valid integer number",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultQualityNumberOfSamplesBelowLOQ","FT94","Field type NUMBER - INTEGER","Checks if the field is a valid NUMBER - INTEGER","The value is not a valid integer number",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultMinimumValue","FT96","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultMeanValue","FT98","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultMaximumValue","FT100","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultMedianValue","FT102","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultStandardDeviationValue","FT103","Field type NUMBER - DECIMAL","Checks if the field is a valid NUMBER - DECIMAL","The value is not a valid integer or decimal number",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultNumberOfSitesClass1","FT112","Field type NUMBER - INTEGER","Checks if the field is a valid NUMBER - INTEGER","The value is not a valid integer number",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultNumberOfSitesClass2","FT113","Field type NUMBER - INTEGER","Checks if the field is a valid NUMBER - INTEGER","The value is not a valid integer number",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultNumberOfSitesClass3","FT114","Field type NUMBER - INTEGER","Checks if the field is a valid NUMBER - INTEGER","The value is not a valid integer number",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultNumberOfSitesClass4","FT115","Field type NUMBER - INTEGER","Checks if the field is a valid NUMBER - INTEGER","The value is not a valid integer number",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultNumberOfSitesClass5","FT116","Field type NUMBER - INTEGER","Checks if the field is a valid NUMBER - INTEGER","The value is not a valid integer number",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","","TU118","Table type uniqueConstraint","Checks if waterBodyIdentifier, waterBodyIdentifierScheme, observedPropertyDeterminandCode, procedureAnalysedMatrix and phenomenonTimeReferenceYear are uniques within table","Uniqueness and multiplicity constraints - The fields waterBodyIdentifier, waterBodyIdentifierScheme, observedPropertyDeterminandCode, procedureAnalysedMatrix and phenomenonTimeReferenceYear are uniques within table",,"TABLE","BLOCKER","true","true","true"
"DisaggregatedData","parameterWaterBodyCategory","FC119","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","resultUom","01a_mandatory_resultUom_missing","Mandatory resultUom test - missing unjustified","Tests that the resultUom is reported, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The resultUom is missing without a proper justification in the resultObservationStatus field.","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE (""resultuom"" IS NULL or ""resultuom"" = '')
  AND (
   ""resultobservationstatus"" NOT IN ('L','M','N','O','Z') 
   OR ""resultobservationstatus"" IS NULL OR ""resultobservationstatus""=''
  )","FIELD","BLOCKER","false","true","true"
"DisaggregatedData","phenomenonTimeSamplingDate","07d_constraints_phenomenonTimeSamplingDate","Value constraints test - phenomenonTimeSamplingDate","Tests that the phenomenonTimeSamplingDate values are within the expected range (1900-2023).","The reported phenomenonTimeSamplingDate value is outside the expected range (1900-2023)","WITH
CTE_12422_dataflowmetadata AS (
    SELECT record_id
        ,CASE WHEN ""metadatavalueinteger"" = '' THEN NULL WHEN ISNUMERIC(""metadatavalueinteger"") THEN CAST(""metadatavalueinteger"" AS INT) ELSE NULL END as ""metadatavalueinteger""
        ,CASE WHEN ""metadatacode"" = '' THEN NULL ELSE ""metadatacode"" END as ""metadatacode""
    FROM dataset_74232.""dataflowmetadata""
)

,CTE_12421_disaggregateddata AS (
    SELECT record_id
        ,CASE WHEN ""phenomenontimesamplingdate"" = '' THEN NULL WHEN ISDATE(""phenomenontimesamplingdate"") THEN TO_DATE(""phenomenontimesamplingdate"", 'YYYY-MM-DD', 1) ELSE NULL END as ""phenomenontimesamplingdate""
    FROM dataset_74231.""disaggregateddata""
)

,
refYear as (
  SELECT n.""metadatavalueinteger"" as yearMin 
    , x.""metadatavalueinteger"" as yearMax 
  FROM CTE_12422_dataflowmetadata as n 
  CROSS JOIN CTE_12422_dataflowmetadata as x 
  WHERE n.""metadatacode"" = 'referenceYearMin' 
  AND x.""metadatacode"" = 'referenceYearMax' 
) 

,d as (
  SELECT *,  EXTRACT(YEAR FROM ""phenomenontimesamplingdate"") as dateYear
  FROM CTE_12421_disaggregateddata 
)

SELECT d.record_id
FROM d
CROSS JOIN refYear 
WHERE d.dateYear < refYear.yearMin 
  OR d.dateYear > refYear.yearMax","FIELD","WARNING","false","true","true"
"DisaggregatedData","resultObservedValue","08a_limit_resultObservedValue_acceptable","Value limit test - resultObservedValue - acceptable limits","Tests that the resultObservedValue follows acceptable limits for the respective observed property determinands.","The reported resultObservedValue is outside the acceptable limits ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id,
CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" as limitmin
  , refer.""limitmax""  as limitmax

FROM dataset_74231.""disaggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') <>'Z'
  AND refer.""tablename"" = 'DisaggregatedData'
  AND rep.""resultobservedvalue"" IS NOT NULL 
  AND rep.""resultobservedvalue"" <> ''
  AND (
    ( 
      refer.""limitminqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultobservedvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultobservedvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultobservedvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultobservedvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","BLOCKER","false","true","true"
"DisaggregatedData","resultObservedValue","08b_limit_resultObservedValue_expected","Value limit test - resultObservedValue - expected range","Tests that the resultObservedValue is within the commonly expected range for the respective observed property determinands.","The reported resultObservedValue is outside the the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""disaggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') NOT IN ('Z','A')
  AND refer.""tablename"" = 'DisaggregatedData'
  AND rep.""resultobservedvalue"" IS NOT NULL 
AND rep.""resultobservedvalue"" <>''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultobservedvalue"" AS NUMERIC(32,16))< CAST(refer.""limitmin"" AS NUMERIC(32,16))) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultobservedvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultobservedvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultobservedvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16))) 
      )
    )
  )","FIELD","WARNING","false","true","true"
"DisaggregatedData","resultObservedValue","08c_limit_resultObservedValue_confirmed","Value limit test - resultObservedValue - confirmed outlier","Detects records with confirmed resultObservedValue outside the commonly expected range for the respective observed property determinands.","The reported resultObservedValue is a confirmed outlier outside the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""disaggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE rep.""resultobservationstatus""='A'
  AND refer.""tablename"" = 'DisaggregatedData'
  AND rep.""resultobservedvalue"" IS NOT NULL 
  AND rep.""resultobservedvalue"" <>''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultobservedvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultobservedvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST( rep.""resultobservedvalue"" AS NUMERIC(32,16))> CAST(refer.""limitmax"" AS NUMERIC(32,16))) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST( rep.""resultobservedvalue"" AS NUMERIC(32,16)) >= CAST( refer.""limitmax"" AS NUMERIC(32,16))) 
      )
    )
  )","FIELD","INFO","false","true","true"
"DisaggregatedData","procedureLOQValue","09a_limit_procedureLOQvalue_acceptable","Value limit test - procedureLOQvalue - acceptable limits","Tests that the procedureLOQvalue follows acceptable limits for the respective observed property determinands.","The reported procedureLOQvalue is outside the acceptable limits ({%minoperator%}{%limitminloq%} and {%maxoperator%}{%limitmaxloq%}).","SELECT rep.record_id 
  ,CASE refer.""limitminloqinclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  ,CASE refer.""limitmaxloqinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' 
  END AS maxoperator 
  ,refer.""limitminloq"" 
  ,refer.""limitmaxloq"" 
FROM dataset_74231.""disaggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') <>'Z'
  AND refer.""tablename"" = 'DisaggregatedData'
  AND rep.""procedureloqvalue"" IS NOT NULL 
  AND rep.""procedureloqvalue"" <>''
  AND (
    ( 
      refer.""limitminloqqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitminloqinclusive"" = '1' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitminloq"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitminloqinclusive"" = '0' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitminloq"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxloqqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxloqinclusive"" = '1' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmaxloq"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxloqinclusive"" = '0' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmaxloq"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","BLOCKER","false","true","true"
"DisaggregatedData","procedureLOQValue","09b_limit_procedureLOQvalue_expected","Value limit test - procedureLOQvalue - expected range","Tests that the procedureLOQvalue is within the commonly expected range for the respective observed property determinands.","The reported procedureLOQvalue is outside the commonly expected range ({%minoperator%}{%limitminloq%} and {%maxoperator%}{%limitmaxloq%}).","SELECT rep.record_id 
  ,CASE refer.""limitminloqinclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  ,CASE refer.""limitmaxloqinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' 
  END AS maxoperator 
  ,refer.""limitminloq"" 
  ,refer.""limitmaxloq"" 
FROM dataset_74231.""disaggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') <>'Z'
  AND refer.""tablename"" = 'DisaggregatedData'
  AND rep.""procedureloqvalue"" IS NOT NULL 
  AND rep.""procedureloqvalue"" <>''
  AND (
    ( 
      refer.""limitminloqqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitminloqinclusive"" = '1' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitminloq"" AS NUMERIC(32,16))) 
        OR ( refer.""limitminloqinclusive""  = '0' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitminloq"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxloqqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxloqinclusive"" = '1' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmaxloq"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxloqinclusive"" = '0' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmaxloq"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","WARNING","false","true","true"
"DisaggregatedData","monitoringSiteIdentifierScheme","FC139","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","monitoringSiteIdentifierScheme","FT140","Field type CODELIST","Checks if the field is a valid SINGLESELECT_CODELIST","The value is not a valid member of the codelist",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","parameterWaterBodyCategory","TC141","Field type LINK","Checks if the record based on criteria is valid LINK","The value is not a valid member of the referenced list.",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","observedPropertyDeterminandCode","TC142","Field type LINK","Checks if the record based on criteria is valid LINK","The value is not a valid member of the referenced list.",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","procedureAnalysedMatrix","TC143","Field type LINK","Checks if the record based on criteria is valid LINK","The value is not a valid member of the referenced list.",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","resultUom","TC144","Field type LINK","Checks if the record based on criteria is valid LINK","The value is not a valid member of the referenced list.",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","parameterSpecies","TC147","Field type LINK","Checks if the record based on criteria is valid LINK","The value is not a valid member of the referenced list.",,"FIELD","WARNING","true","true","true"
"DisaggregatedData","resultObservationStatus","TC148","Field type LINK","Checks if the record based on criteria is valid LINK","The value is not a valid member of the referenced list.",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","monitoringSiteIdentifierScheme","FC149","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","monitoringSiteIdentifierScheme","FT150","Field type CODELIST","Checks if the field is a valid SINGLESELECT_CODELIST","The value is not a valid member of the codelist",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","parameterWaterBodyCategory","TC151","Field type LINK","Checks if the record based on criteria is valid LINK","The value is not a valid member of the referenced list.",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","parameterWaterBodyCategory","TC152","Field type LINK","Checks if the record based on criteria is valid LINK","The value is not a valid member of the referenced list.",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","observedPropertyDeterminandCode","TC153","Field type LINK","Checks if the record based on criteria is valid LINK","The value is not a valid member of the referenced list.",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","observedPropertyDeterminandCode","TC154","Field type LINK","Checks if the record based on criteria is valid LINK","The value is not a valid member of the referenced list.",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","procedureAnalysedMatrix","TC155","Field type LINK","Checks if the record based on criteria is valid LINK","The value is not a valid member of the referenced list.",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","procedureAnalysedMatrix","TC156","Field type LINK","Checks if the record based on criteria is valid LINK","The value is not a valid member of the referenced list.",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","resultUom","TC157","Field type LINK","Checks if the record based on criteria is valid LINK","The value is not a valid member of the referenced list.",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultUom","TC158","Field type LINK","Checks if the record based on criteria is valid LINK","The value is not a valid member of the referenced list.",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","resultObservationStatus","TC159","Field type LINK","Checks if the record based on criteria is valid LINK","The value is not a valid member of the referenced list.",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultObservationStatus","TC160","Field type LINK","Checks if the record based on criteria is valid LINK","The value is not a valid member of the referenced list.",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","resultQualityMinimumBelowLOQ","FT161","Field type CODELIST","Checks if the field is a valid SINGLESELECT_CODELIST","The value is not a valid member of the codelist",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultQualityMinimumBelowLOQ","FT162","Field type CODELIST","Checks if the field is a valid SINGLESELECT_CODELIST","The value is not a valid member of the codelist",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","resultQualityMeanBelowLOQ","FT163","Field type CODELIST","Checks if the field is a valid SINGLESELECT_CODELIST","The value is not a valid member of the codelist",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultQualityMeanBelowLOQ","FT164","Field type CODELIST","Checks if the field is a valid SINGLESELECT_CODELIST","The value is not a valid member of the codelist",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","resultQualityMaximumBelowLOQ","FT165","Field type CODELIST","Checks if the field is a valid SINGLESELECT_CODELIST","The value is not a valid member of the codelist",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultQualityMaximumBelowLOQ","FT166","Field type CODELIST","Checks if the field is a valid SINGLESELECT_CODELIST","The value is not a valid member of the codelist",,"FIELD","BLOCKER","true","true","true"
"AggregatedData","resultQualityMedianBelowLOQ","FT167","Field type CODELIST","Checks if the field is a valid SINGLESELECT_CODELIST","The value is not a valid member of the codelist",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","resultQualityMedianBelowLOQ","FT168","Field type CODELIST","Checks if the field is a valid SINGLESELECT_CODELIST","The value is not a valid member of the codelist",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","waterBodyIdentifierScheme","FC169","Field cardinality","Checks if the field is missing or empty","The value must not be missing or empty",,"FIELD","BLOCKER","true","true","true"
"AggregatedDataByWaterBody","waterBodyIdentifierScheme","FT170","Field type CODELIST","Checks if the field is a valid SINGLESELECT_CODELIST","The value is not a valid member of the codelist",,"FIELD","BLOCKER","true","true","true"
"DisaggregatedData","resultObservedValue","01b_mandatory_resultObservedValue_missing","Mandatory resultObservedValue test - missing unjustified","Tests that the resultObservedValue is reported, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z') or if resultQualityObservedValueBelowLOQ = True.","The resultObservedValue is missing without a proper justification.","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE (""resultobservedvalue"" IS NULL or ""resultobservedvalue"" ='')
  AND (    ""resultqualityobservedvaluebelowloq"" = '0'
    OR ""resultqualityobservedvaluebelowloq"" IS NULL
    OR ""resultqualityobservedvaluebelowloq"" =''
) 
AND (
   ""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR ""resultobservationstatus"" IS NULL
    OR ""resultobservationstatus"" =''
  ) 
","FIELD","BLOCKER","false","true","true"
"DisaggregatedData","resultObservedValue","02b2_conflict_justified_missing_resultObservedValue_reported","Conflicting values test - missing values justified - resultObservedValue reported","Test that the resultObservedValue is empty if it is justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The resultObservedValue is reported although a justification for missing result values is provided.","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE ""resultobservedvalue"" IS NOT NULL and  ""resultobservedvalue"" <>''
  AND ""resultobservationstatus"" IN ('L','M','N','O','Z')","FIELD","WARNING","false","true","true"
"DisaggregatedData","resultObservedValue","07a_constraints_resultObservedValue","Value constraints test - resultObservedValue","Tests that values match the constraints specified in dataset definitions: resultObservedValue >= -3","The value fails the rule: resultObservedValue >= -3","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE COALESCE(""resultobservationstatus"", '') <> 'Z'
AND ISNUMERIC( ""resultobservedvalue"")
AND CAST(""resultobservedvalue"" AS NUMERIC(32,16)) < -3","FIELD","BLOCKER","false","true","true"
"DisaggregatedData","resultQualityObservedValueBelowLOQ","01c_mandatory_resultQualityObservedValueBelowLOQ_missing","Mandatory resultQualityObservedValueBelowLOQ test - missing unjustified","Tests that the resultQualityObservedValueBelowLOQ is reported, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The resultQualityObservedValueBelowLOQ is missing without a proper justification in the resultObservationStatus field.","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE (""resultqualityobservedvaluebelowloq"" IS NULL or ""resultqualityobservedvaluebelowloq"" ='')
  AND (
  ""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR  ""resultobservationstatus""  IS NULL
    OR  ""resultobservationstatus"" =''
  )

 ","FIELD","BLOCKER","false","true","true"
"DisaggregatedData","resultQualityObservedValueBelowLOQ","02b3_conflict_justified_missing_resultQualityObservedValueBelowLOQ_reported","Conflicting values test - missing values justified - resultQualityObservedValueBelowLOQ reported","Test that the resultQualityObservedValueBelowLOQ is empty if it is justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The resultQualityObservedValueBelowLOQ is reported although a justification for missing result values is provided.","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE (""resultqualityobservedvaluebelowloq"" IS NULL or ""resultqualityobservedvaluebelowloq"" = '')
  AND ""resultobservationstatus"" IN ('L','M','N','O','Z')","FIELD","WARNING","false","true","true"
"DisaggregatedData","resultQualityObservedValueBelowLOQ","02d_conflict_resultQualityObservedValueBelowLOQ_LOQinapplicable","Conflicting values test - resultQualityObservedValueBelowLOQ - inapplicable LOQ","Tests that the resultQualityObservedValueBelowLOQ is False for determinands where LOQ is inapplicable.","The resultQualityObservedValueBelowLOQ is True for a determinand where it is inapplicable.","SELECT D.record_id
FROM dataset_74231.""disaggregateddata"" as D
INNER JOIN (  
SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'DisaggregatedData'
    AND ""loqmandatory"" = -1
) as R

  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode"" 
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE D.""resultqualityobservedvaluebelowloq"" <> '0'
  AND (
    D.""resultobservationstatus"" NOT IN ('Z')
    OR D.""resultobservationstatus"" IS NULL
    OR D.""resultobservationstatus"" = ''
  )","FIELD","BLOCKER","false","true","true"
"DisaggregatedData","procedureLOQValue","01d1_mandatory_procedureLOQValue_determinand_missing","Mandatory procedureLOQValue determinand test - missing unjustified","Tests that the procedureLOQValue is reported for determinands where it is mandatory, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The procedureLOQValue is mandatory for the reported determinand, but it is missing without a proper justification.","SELECT D.record_id
FROM dataset_74231.""disaggregateddata"" as D
LEFT JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'DisaggregatedData'
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE (D.""procedureloqvalue"" IS NULL or  D.""procedureloqvalue""  = '')
  AND R.""loqmandatory"" = '1'
  AND (
    D.""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR D.""resultobservationstatus"" IS NULL
    OR D.""resultobservationstatus"" = ''
  )
 ","FIELD","BLOCKER","false","true","true"
"DisaggregatedData","procedureLOQValue","01d2_mandatory_procedureLOQValue_belowLOQ_missing","Mandatory procedureLOQValue BelowLOQ test - missing unjustified","Tests that the procedureLOQValue is reported where BelowLOQ flag is true, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z'), or if LOQ is inapplicable for the reported determinand.","The procedureLOQValue is mandatory because the BelowLOQ flag is true, but it is missing without a proper justification.","SELECT D.record_id
FROM dataset_74231.""disaggregateddata"" as D
LEFT JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename""  = 'DisaggregatedData'
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
 AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE (D.""procedureloqvalue"" IS NULL or D.""procedureloqvalue"" = '')
  AND D.""resultqualityobservedvaluebelowloq"" = '1'
  AND R.""loqmandatory"" <> -1
  AND (
   D.""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR D.""resultobservationstatus"" IS NULL
    OR D.""resultobservationstatus"" = ''
  )","FIELD","BLOCKER","false","true","true"
"DisaggregatedData","procedureLOQValue","02a_conflict_procedureLOQValue_inapplicable_reported","Conflicting values test - procedureLOQValue - inapplicable reported","Tests that the procedureLOQValue is not reported for determinands for which it is inapplicable.","The procedureLOQValue is reported for a determinand where it is inapplicable.","SELECT D.record_id
FROM dataset_74231.""disaggregateddata"" as D
INNER JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'DisaggregatedData'
    AND ""loqmandatory"" = -1
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE D.""procedureloqvalue"" IS NOT NULL
AND D.""procedureloqvalue""  <> ''
  AND (
    D.""resultobservationstatus"" NOT IN ('Z')
    OR D.""resultobservationstatus"" IS NULL
    OR D.""resultobservationstatus"" = ''
  )
","FIELD","BLOCKER","false","true","true"
"DisaggregatedData","procedureLOQValue","02b4_conflict_justified_missing_procedureLOQValue_reported","Conflicting values test - missing values justified - procedureLOQValue reported","Test that the procedureLOQValue is empty if it is justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The procedureLOQValue is reported although a justification for missing result values is provided.","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE ""procedureloqvalue"" IS NOT NULL
AND  ""procedureloqvalue"" <> ''
  AND ""resultobservationstatus"" IN ('L','M','N','O','Z')
","FIELD","WARNING","false","true","true"
"DisaggregatedData","resultUom","02b1_conflict_justified_missing_resultUom_reported","Conflicting values test - missing values justified - resultUom reported","Test that the resultUom is empty if it is justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The resultUom is reported although a justification for missing result values is provided.","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE ""resultuom"" IS NOT NULL
AND ""resultuom""  <> ''
  AND ""resultobservationstatus"" IN ('L','M','N','O','Z')","FIELD","WARNING","false","true","true"
"DisaggregatedData","parameterSpecies","01f_mandatory_parameterSpecies_missing","Mandatory parameterSpecies test - missing biota","Tests that the parameterSpecies is reported for Biota records.","The parameterSpecies is missing.","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE (""parameterspecies"" IS NULL OR ""parameterspecies"" ='')
  AND ""procedureanalysedmatrix"" = 'B'
","FIELD","BLOCKER","false","true","true"
"DisaggregatedData","parameterSampleDepth","02c1_conflict_non-water_parameterSampleDepth","Conflicting values test - parameterSampleDepth in non-Water records","Tests that the Water specific values parameterSampleDepth is reported only in Water records.","The parameterSampleDepth is reported for non-Water record.","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE ""resultobservationstatus"" NOT IN ('Z')
  AND ""parametersampledepth"" IS NOT NULL
  AND ""parametersampledepth"" <> ''
  AND LEFT(""procedureanalysedmatrix"",1) <> 'W'
","FIELD","BLOCKER","false","true","true"
"DisaggregatedData","parameterSampleDepth","07b_constraints_parameterSampleDepth","Value constraints test - parameterSampleDepth","Tests that values match the constraints specified in dataset definitions: parameterSampleDepth >= 0 and < 11000","The value fails the rule: parameterSampleDepth >= 0 and < 11000","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ISNUMERIC(""parametersampledepth"") 
  AND ( 
    CAST(""parametersampledepth"" AS NUMERIC(32,16)) < 0  
    OR CAST(""parametersampledepth"" AS NUMERIC(32,16)) >= 11000 
  )
","FIELD","BLOCKER","false","true","true"
"DisaggregatedData","parameterSedimentDepthSampled","02c3_conflict_non-sediment_parameterSedimentDepthSampled","Conflicting values test - parameterSedimentDepthSampled in non-Sediment records","Tests that the Sediment specific value parameterSedimentDepthSampled is reported only in Sediment records.","The parameterSedimentDepthSampled is reported for non-Sediment record.","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE ""resultobservationstatus"" NOT IN ('Z')
  AND ""parametersedimentdepthsampled"" IS NOT NULL
  AND ""parametersedimentdepthsampled"" <> ''
  AND LEFT(""procedureanalysedmatrix"",1) <> 'S'
","FIELD","BLOCKER","false","true","true"
"DisaggregatedData","monitoringSiteIdentifier","04a_spatialIdentifier_country","Monitoring site identifier test - country code","Tests that the country code part of the monitoringSiteIdentifier value matches the one of the reporting country.","The monitoringSiteIdentifier doesn't match the reporting country. It should start with '{%R3_COUNTRY_CODE%}'.","SELECT record_id
  --,'{%R3_COUNTRY_CODE%}' as cc 
FROM dataset_74231.""disaggregateddata"" 
WHERE LEFT(""monitoringsiteidentifier"",2) <> '{%R3_COUNTRY_CODE%}'
","FIELD","BLOCKER","false","true","true"
"DisaggregatedData","monitoringSiteIdentifier","04b_spatialIdentifier_format","Monitoring site identifier test - format","Tests correctness of the spatialUnitIdentifier value format.","The monitoringSiteIdentifier value has incorrect format.","SELECT record_id 
FROM dataset_74231.""disaggregateddata""
WHERE NOT REGEXP_LIKE(""monitoringsiteidentifier"", '^[A-Z]{2}[0-9A-Z]{1}([0-9A-Z_\-]{0,38}[0-9A-Z]{1}){0,1}$')
  OR NOT REGEXP_LIKE(""monitoringsiteidentifier"", '^([A-Z0-9](\-|_)?)+$')

","FIELD","BLOCKER","false","true","true"
"AggregatedData","resultUom","01a_mandatory_resultUom_missing","Mandatory resultUom test - missing unjustified","Tests that the resultUom is reported, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The resultUom is missing without a proper justification in the resultObservationStatus field.","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE (""resultuom"" IS NULL or ""resultuom"" = '')
  AND (
    ""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR ""resultobservationstatus"" IS NULL
    OR ""resultobservationstatus"" =''
  )","FIELD","BLOCKER","false","true","true"
"AggregatedData","resultUom","02b1_conflict_justified_missing_resultUom_reported","Conflicting values test - missing values justified - resultUom reported","Test that the resultUom is empty if it is justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The resultUom is reported although a justification for missing result values is provided.","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE ""resultuom"" IS NOT NULL and ""resultuom""<>''
  AND ""resultobservationstatus"" IN ('L','M','N','O','Z')","FIELD","WARNING","false","true","true"
"AggregatedData","resultNumberOfSamples","01b_mandatory_resultNumberOfSamples_missing","Mandatory resultNumberOfSamples test - missing unjustified","Tests that the resultNumberOfSamples is reported, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The resultObservedValue is missing without a proper justification.","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE (""resultnumberofsamples"" IS NULL or ""resultnumberofsamples"" = '')
  AND (
    ""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR ""resultobservationstatus"" IS NULL
    OR ""resultobservationstatus"" =''
  )","FIELD","BLOCKER","false","true","true"
"AggregatedData","resultNumberOfSamples","07a_constraints_resultNumberOfSamples","Value constraints test - resultNumberOfSamples","Tests that values match the constraints specified in dataset definitions: resultNumberOfSamples >= 1","The value fails the rule: resultNumberOfSamples >= 1","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
AND ISNUMERIC(""resultnumberofsamples"")
AND CAST(""resultnumberofsamples"" AS NUMERIC(32,16)) < 1","FIELD","BLOCKER","false","true","true"
"AggregatedData","procedureLOQValue","01e1_mandatory_procedureLOQValue_determinand_missing","Mandatory procedureLOQValue determinand test - missing unjustified","Tests that the procedureLOQValue is reported for determinands where it is mandatory, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The procedureLOQValue is mandatory for the reported determinand, but it is missing without a proper justification.","SELECT D.record_id
FROM dataset_74231.""aggregateddata"" as D
LEFT JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'AggregatedData'
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE (D.""procedureloqvalue"" IS NULL OR D.""procedureloqvalue""='')
  AND R.""loqmandatory"" = 1
  AND (
    D.""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR D.""resultobservationstatus"" IS NULL
    OR D.""resultobservationstatus"" =''
  )
","FIELD","BLOCKER","false","true","true"
"AggregatedData","procedureLOQValue","01e2_mandatory_procedureLOQValue_belowLOQ_missing","Mandatory procedureLOQValue BelowLOQ test - missing unjustified","Tests that the procedureLOQValue is reported if any of the BelowLOQ flags is true, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z'), or if LOQ is inapplicable for the reported determinand.","The procedureLOQValue is mandatory because at least one of the BelowLOQ flags is true, but it is missing without a proper justification.","SELECT D.record_id
FROM dataset_74231.""aggregateddata"" as D
LEFT JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'AggregatedData'
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
 AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE (D.""procedureloqvalue"" IS NULL OR  D.""procedureloqvalue""='')
  AND (
    ""resultqualityminimumbelowloq"" = '1'
    OR  ""resultqualitymeanbelowloq"" = '1'
    OR  ""resultqualitymaximumbelowloq"" = '1'
    OR  ""resultqualitymedianbelowloq"" = '1'
  )
  AND R.""loqmandatory"" <> -1
  AND (
    D.""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR D.""resultobservationstatus"" IS NULL
    OR D.""resultobservationstatus""=''
  )","FIELD","BLOCKER","false","true","true"
"AggregatedData","procedureLOQValue","02a1_conflict_procedureLOQValue_inapplicable_reported","Conflicting values test - procedureLOQValue - inapplicable reported","Tests that the procedureLOQValue is not reported for determinands for which it is inapplicable.","The procedureLOQValue is reported for a determinand where it is inapplicable.","SELECT D.record_id
FROM dataset_74231.""aggregateddata"" as D
INNER JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'AggregatedData'
    AND ""loqmandatory"" = -1
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE D.""procedureloqvalue"" IS NOT NULL AND D.""procedureloqvalue"" <>''
  AND (
    D.""resultobservationstatus"" NOT IN ('Z')
    OR D.""resultobservationstatus"" IS NULL
    OR D.""resultobservationstatus"" =''
  )","FIELD","BLOCKER","false","true","true"
"AggregatedData","procedureLOQValue","09a_limit_procedureLOQvalue_acceptable","Value limit test - procedureLOQvalue - acceptable limits","Tests that the procedureLOQvalue follows acceptable limits for the respective observed property determinands.","The reported procedureLOQvalue is outside the acceptable limits ({%minoperator%}{%limitminloq%} and {%maxoperator%}{%limitmaxloq%}).","SELECT rep.record_id 
  ,CASE refer.""limitminloqinclusive""
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  ,CASE refer.""limitmaxloqinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' 
  END AS maxoperator 
  ,refer.""limitminloq""
  ,refer.""limitmaxloq""
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') <>'Z'
  AND refer.""tablename"" = 'AggregatedData'
  AND rep.""procedureloqvalue"" IS NOT NULL and rep.""procedureloqvalue""<>''
  AND (
    ( 
      refer.""limitminloqqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitminloqinclusive"" = '1' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitminloq"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitminloqinclusive"" = '0' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitminloq"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxloqqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxloqinclusive"" = '1' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmaxloq"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxloqinclusive"" = '0' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmaxloq""  AS NUMERIC(32,16))) 
      )
    )
  )","FIELD","BLOCKER","false","true","true"
"AggregatedData","procedureLOQValue","09b_limit_procedureLOQvalue_expected","Value limit test - procedureLOQvalue - expected range","Tests that the procedureLOQvalue is within the commonly expected range for the respective observed property determinands.","The reported procedureLOQvalue is outside the commonly expected range ({%minoperator%}{%limitminloq%} and {%maxoperator%}{%limitmaxloq%}).","SELECT rep.record_id 
  ,CASE refer.""limitminloqinclusive""
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  ,CASE refer.""limitmaxloqinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' 
  END AS maxoperator 
  ,refer.""limitminloq"" 
  ,refer.""limitmaxloq""
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode""
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') <>'Z'
  AND refer.""tablename"" = 'AggregatedData'
  AND rep.""procedureloqvalue"" IS NOT NULL 
  AND rep.""procedureloqvalue"" <> ''
  AND (
    ( 
      refer.""limitminloqqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitminloqinclusive"" = '1' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16))< CAST(refer.""limitminloq"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitminloqinclusive"" = '0' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitminloq"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxloqqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxloqinclusive"" = '1' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmaxloq"" AS NUMERIC(32,16))) 
        OR ( refer.""limitmaxloqinclusive"" = '0' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmaxloq"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","WARNING","false","true","true"
"AggregatedData","resultQualityNumberOfSamplesBelowLOQ","01f1_mandatory_resultQualityNumberOfSamplesBelowLOQ_determinand_missing","Mandatory resultQualityNumberOfSamplesBelowLOQ determinand test - missing unjustified","Tests that the resultQualityNumberOfSamplesBelowLOQ is reported for determinands where it is mandatory, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The resultQualityNumberOfSamplesBelowLOQ is mandatory for the reported determinand, but it is missing without a proper justification.","SELECT D.record_id
FROM dataset_74231.""aggregateddata"" as D
LEFT JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'AggregatedData'
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE (D.""resultqualitynumberofsamplesbelowloq"" IS NULL OR D.""resultqualitynumberofsamplesbelowloq"" = '')
  AND R.""loqmandatory"" = 1
  AND (
    D.""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR D.""resultobservationstatus"" IS NULL
    OR D.""resultobservationstatus"" = ''
  )","FIELD","BLOCKER","false","true","true"
"AggregatedData","resultQualityNumberOfSamplesBelowLOQ","01f2_mandatory_resultQualityNumberOfSamplesBelowLOQ_belowLOQ_missing","Mandatory resultQualityNumberOfSamplesBelowLOQ BelowLOQ test - missing unjustified","Tests that the resultQualityNumberOfSamplesBelowLOQ is reported if any of the BelowLOQ flags is true, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z'), or if LOQ is inapplicable for the reported determinand.","The resultQualityNumberOfSamplesBelowLOQ is mandatory because at least one of the BelowLOQ flags is true, but it is missing without a proper justification.","SELECT D.record_id
FROM dataset_74231.""aggregateddata"" as D
LEFT JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'AggregatedData'
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE (D.""resultqualitynumberofsamplesbelowloq"" IS NULL
OR  D.""resultqualitynumberofsamplesbelowloq"" = '')
  AND (
    ""resultqualityminimumbelowloq"" = '1'
    OR  ""resultqualitymeanbelowloq"" = '1'
    OR  ""resultqualitymaximumbelowloq"" = '1'
    OR  ""resultqualitymedianbelowloq"" = '1'
  )
  AND R.""loqmandatory"" <> -1
  AND (
    D.""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR D.""resultobservationstatus"" IS NULL
    OR D.""resultobservationstatus"" = ''
  )
","FIELD","BLOCKER","false","true","true"
"AggregatedData","resultQualityNumberOfSamplesBelowLOQ","02a2_conflict_resultQualityNumberOfSamplesBelowLOQ_inapplicable_reported","Conflicting values test - resultQualityNumberOfSamplesBelowLOQ - inapplicable reported","Tests that the resultQualityNumberOfSamplesBelowLOQ is not reported for determinands for which it is inapplicable.","The resultQualityNumberOfSamplesBelowLOQ is reported for a determinand where it is inapplicable.","SELECT D.record_id
FROM dataset_74231.""aggregateddata"" as D
INNER JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'AggregatedData'
    AND ""loqmandatory"" = -1
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE D.""resultqualitynumberofsamplesbelowloq"" IS NOT NULL
AND D.""resultqualitynumberofsamplesbelowloq"" <>''
  AND (
    D.""resultobservationstatus"" NOT IN ('Z')
    OR D.""resultobservationstatus"" IS NULL
    OR D.""resultobservationstatus"" = ''
  )
","FIELD","BLOCKER","false","true","true"
"AggregatedData","resultQualityNumberOfSamplesBelowLOQ","07b_constraints_resultQualityNumberOfSamplesBelowLOQ","Value constraints test - resultQualityNumberOfSamplesBelowLOQ","Tests that values match the constraints specified in dataset definitions: resultQualityNumberOfSamplesBelowLOQ >= 0","The value fails the rule: resultQualityNumberOfSamplesBelowLOQ >= 0","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ISNUMERIC( ""resultqualitynumberofsamplesbelowloq"")
  AND CAST(""resultqualitynumberofsamplesbelowloq"" AS NUMERIC(32,16)) < 0","FIELD","BLOCKER","false","true","true"
"AggregatedData","monitoringSiteIdentifier","04a_spatialIdentifier_country","Monitoring site identifier test - country code","Tests that the country code part of the monitoringSiteIdentifier value matches the one of the reporting country.","The monitoringSiteIdentifier doesn't match the reporting country. It should start with '{%R3_COUNTRY_CODE%}'.","SELECT record_id
  --,'{%R3_COUNTRY_CODE%}' as cc 
FROM dataset_74231.""aggregateddata"" 
WHERE LEFT(""monitoringsiteidentifier"",2) <> '{%R3_COUNTRY_CODE%}'","FIELD","BLOCKER","false","true","true"
"AggregatedData","monitoringSiteIdentifier","04b_spatialIdentifier_format","Monitoring site identifier test - format","Tests correctness of the spatialUnitIdentifier value format.","The monitoringSiteIdentifier value has incorrect format.","SELECT record_id 
FROM dataset_74231.""aggregateddata""
WHERE 
NOT REGEXP_LIKE(""monitoringsiteidentifier"", '^[A-Z]{2}[0-9A-Z]{1}([0-9A-Z_\-]{0,38}[0-9A-Z]{1}){0,1}$')
  OR 
NOT REGEXP_LIKE(""monitoringsiteidentifier"", '^([A-Z0-9](\-|_)?)+$')","FIELD","BLOCKER","false","true","true"
"AggregatedData","procedureAnalysedMatrix","06b_coherence_procedureAnalysedMatrix","Coherence test - procedureAnalysedMatrix","Tests that table contains only Water data.","Biota and Sediment data can not be reported in this table.","SELECT record_id
FROM dataset_74231.""aggregateddata"" 
WHERE LEFT(""procedureanalysedmatrix"", 1) <> 'W'","FIELD","BLOCKER","false","true","true"
"AggregatedData","resultStandardDeviationValue","07c_constraints_resultStandardDeviationValue","Value constraints test - resultStandardDeviationValue","Tests that values match the constraints specified in dataset definitions: resultStandardDeviationValue >= 0","The value fails the rule: resultStandardDeviationValue >= 0","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ISNUMERIC(""resultstandarddeviationvalue"") 
  AND CAST(""resultstandarddeviationvalue"" AS NUMERIC(32,16)) < 0","FIELD","BLOCKER","false","true","true"
"AggregatedData","parameterSampleDepth","07d_constraints_parameterSampleDepth","Value constraints test - parameterSampleDepth","Tests that values match the constraints specified in dataset definitions: parameterSampleDepth >= 0 and < 11000","The value fails the rule: parameterSampleDepth >= 0 and < 11000","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ISNUMERIC(""parametersampledepth"") 
  AND (
    CAST(""parametersampledepth"" AS NUMERIC(32,16)) < 0 
    OR CAST(""parametersampledepth"" AS NUMERIC(32,16)) >= 11000
  )","FIELD","BLOCKER","false","true","true"
"AggregatedData","phenomenonTimeReferenceYear","07e_constraints_phenomenonTimeReferenceYear","Value constraints test - phenomenonTimeReferenceYear","Tests that phenomenonTimeReferenceYear value is within the expected range.","The phenomenonTimeReferenceYear is outside the expected range.","WITH 
refYear as (
  SELECT n.""metadatavalueinteger"" as yearMin 
    , x.""metadatavalueinteger"" as yearMax 
  FROM dataset_74232.""dataflowmetadata"" as n 
  CROSS JOIN dataset_74232.""dataflowmetadata"" as x 
  WHERE n.""metadatacode"" = 'referenceYearMin' 
  AND x.""metadatacode"" = 'referenceYearMax' 
) 

SELECT d.record_id 
FROM dataset_74231.""aggregateddata"" as d 
CROSS JOIN refYear 
WHERE d.""phenomenontimereferenceyear"" < refYear.yearMin 
  OR d.""phenomenontimereferenceyear""> refYear.yearMax 
 ","FIELD","WARNING","false","true","true"
"AggregatedData","resultMinimumValue","08a1_limit_resultMinimumValue_acceptable","Value limit test - resultMinimumValue - acceptable limits","Tests that the resultMinimumValue follows acceptable limits for the respective observed property determinands.","The reported resultMinimumValue is outside the acceptable limits ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') <>'Z'
  AND refer.""tablename"" = 'AggregatedData'
  AND rep.""resultminimumvalue"" IS NOT NULL 
  AND rep.""resultminimumvalue""<>''
  AND (
    ( 
      refer.""limitminqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","BLOCKER","false","true","true"
"AggregatedData","resultMinimumValue","08b1_limit_resultMinimumValue_expected","Value limit test - resultMinimumValue - expected range","Tests that the resultMinimumValue is within the commonly expected range for the respective observed property determinands.","The reported resultMinimumValue is outside the the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') NOT IN ('Z','A')
  AND refer.""tablename"" = 'AggregatedData'
  AND rep.""resultminimumvalue"" IS NOT NULL 
  AND rep.""resultminimumvalue"" <>''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16))) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","WARNING","false","true","true"
"AggregatedData","resultMinimumValue","08c1_limit_resultMinimumValue_confirmed","Value limit test - resultMinimumValue - confirmed outlier","Detects records with confirmed resultMinimumValue outside the commonly expected range for the respective observed property determinands.","The reported resultMinimumValue is a confirmed outlier outside the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE rep.""resultobservationstatus""='A'
  AND refer.""tablename"" = 'AggregatedData'
  AND rep.""resultminimumvalue"" IS NOT NULL 
  AND rep.""resultminimumvalue""<>''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16))) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","INFO","false","true","true"
"AggregatedData","resultMeanValue","08a2_limit_resultMeanValue_acceptable","Value limit test - resultMeanValue - acceptable limits","Tests that the resultMeanValue follows acceptable limits for the respective observed property determinands.","The reported resultMeanValue is outside the acceptable limits ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') <>'Z'
  AND refer.""tablename"" = 'AggregatedData'
  AND rep.""resultmeanvalue"" IS NOT NULL 
  AND rep.""resultmeanvalue"" <>''
  AND (
    ( 
      refer.""limitminqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16))) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","BLOCKER","false","true","true"
"AggregatedData","resultMeanValue","08b2_limit_resultMeanValue_expected","Value limit test - resultMeanValue - expected range","Tests that the resultMeanValue is within the commonly expected range for the respective observed property determinands.","The reported resultMeanValue is outside the the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') NOT IN ('Z','A')
  AND refer.""tablename"" = 'AggregatedData'
  AND rep.""resultmeanvalue"" IS NOT NULL 
  AND rep.""resultmeanvalue"" <> ''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","WARNING","false","true","true"
"AggregatedData","resultMeanValue","08c2_limit_resultMeanValue_confirmed","Value limit test - resultMeanValue - confirmed outlier","Detects records with confirmed resultMeanValue outside the commonly expected range for the respective observed property determinands.","The reported resultMeanValue is a confirmed outlier outside the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE rep.""resultobservationstatus""='A'
  AND refer.""tablename"" = 'AggregatedData'
  AND rep.""resultmeanvalue"" IS NOT NULL 
  AND rep.""resultmeanvalue""<>''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16))> CAST(refer.""limitmax"" AS NUMERIC(32,16))) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","INFO","false","true","true"
"AggregatedData","resultMaximumValue","08a3_limit_resultMaximumValue_acceptable","Value limit test - resultMaximumValue - acceptable limits","Tests that the resultMaximumValue follows acceptable limits for the respective observed property determinands.","The reported resultMaximumValue is outside the acceptable limits ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') <>'Z'
  AND refer.""tablename"" = 'AggregatedData'
  AND rep.""resultmaximumvalue"" IS NOT NULL 
  AND rep.""resultmaximumvalue"" <>''
  AND (
    ( 
      refer.""limitminqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16))) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","BLOCKER","false","true","true"
"AggregatedData","resultMaximumValue","08b3_limit_resultMaximumValue_expected","Value limit test - resultMaximumValue - expected range","Tests that the resultMaximumValue is within the commonly expected range for the respective observed property determinands.","The reported resultMaximumValue is outside the the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') NOT IN ('Z','A')
  AND refer.""tablename"" = 'AggregatedData'
  AND rep.""resultmaximumvalue"" IS NOT NULL
  AND rep.""resultmaximumvalue"" <>'' 
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16))< CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16))) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","WARNING","false","true","true"
"AggregatedData","resultMaximumValue","08c3_limit_resultMaximumValue_confirmed","Value limit test - resultMaximumValue - confirmed outlier","Detects records with confirmed resultMaximumValue outside the commonly expected range for the respective observed property determinands.","The reported resultMaximumValue is a confirmed outlier outside the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE rep.""resultobservationstatus""='A'
  AND refer.""tablename"" = 'AggregatedData'
  AND rep.""resultmaximumvalue"" IS NOT NULL 
  AND rep.""resultmaximumvalue""<>''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","INFO","false","true","true"
"AggregatedData","resultMedianValue","08a4_limit_resultMedianValue_acceptable","Value limit test - resultMedianValue - acceptable limits","Tests that the resultMedianValue follows acceptable limits for the respective observed property determinands.","The reported resultMedianValue is outside the acceptable limits ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') <>'Z'
  AND refer.""tablename"" = 'AggregatedData'
  AND rep.""resultmedianvalue"" IS NOT NULL 
  AND rep.""resultmedianvalue""<>''
  AND (
    ( 
      refer.""limitminqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmedianvalue""  AS NUMERIC(32,16))<= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","BLOCKER","false","true","true"
"AggregatedData","resultMedianValue","08b4_limit_resultMedianValue_expected","Value limit test - resultMedianValue - expected range","Tests that the resultMedianValue is within the commonly expected range for the respective observed property determinands.","The reported resultMedianValue is outside the the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') NOT IN ('Z','A')
  AND refer.""tablename"" = 'AggregatedData'
  AND rep.""resultmedianvalue"" IS NOT NULL 
  AND rep.""resultmedianvalue"" <>''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","WARNING","false","true","true"
"AggregatedData","resultMedianValue","08c4_limit_resultMedianValue_confirmed","Value limit test - resultMedianValue - confirmed outlier","Detects records with confirmed resultMedianValue outside the commonly expected range for the respective observed property determinands.","The reported resultMedianValue is a confirmed outlier outside the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE rep.""resultobservationstatus""='A'
  AND refer.""tablename"" = 'AggregatedData'
  AND rep.""resultmedianvalue"" IS NOT NULL 
  AND rep.""resultmedianvalue"" <>''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16))) 
      )
    )
  )","FIELD","INFO","false","true","true"
"AggregatedDataByWaterBody","resultUom","02b1_conflict_justified_missing_resultUom_reported","Conflicting values test - missing values justified - resultUom reported","Test that the resultUom is empty if it is justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The resultUom is reported although a justification for missing result values is provided.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE ""resultuom"" IS NOT NULL and ""resultuom"" <> ''
AND ""resultobservationstatus"" IN ('L','M','N','O','Z')
","FIELD","WARNING","false","true","true"
"AggregatedDataByWaterBody","resultNumberOfSamples","07a_constraints_resultNumberOfSamples","Value constraints test - resultNumberOfSamples","Tests that values match the constraints specified in dataset definitions: resultNumberOfSamples >= 1","The value fails the rule: resultNumberOfSamples >= 1","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
AND ISNUMERIC(""resultnumberofsamples"")
AND ""resultnumberofsamples"" < 1","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","procedureLOQValue","01e2_mandatory_procedureLOQValue_belowLOQ_missing","Mandatory procedureLOQValue BelowLOQ test - missing unjustified","Tests that the procedureLOQValue is reported if any of the BelowLOQ flags is true, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z'), or if LOQ is inapplicable for the reported determinand.","The procedureLOQValue is mandatory because at least one of the BelowLOQ flags is true, but it is missing without a proper justification.","SELECT D.record_id
FROM dataset_74231.""aggregateddatabywaterbody"" as D
LEFT JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'AggregatedDataByWaterBody'
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE (D.""procedureloqvalue"" IS NULL or D.""procedureloqvalue"" ='')
  AND (
    ""resultqualityminimumbelowloq"" = '1'
    OR  ""resultqualitymeanbelowloq"" = '1'
    OR  ""resultqualitymaximumbelowloq"" = '1'
    OR  ""resultqualitymedianbelowloq"" = '1'
  )
  AND R.""loqmandatory"" <> -1
  AND (
    D.""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR D.""resultobservationstatus"" IS NULL
    OR D.""resultobservationstatus"" = ''
  )","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","procedureLOQValue","02a1_conflict_procedureLOQValue_inapplicable_reported","Conflicting values test - procedureLOQValue - inapplicable reported","Tests that the procedureLOQValue is not reported for determinands for which it is inapplicable.","The procedureLOQValue is reported for a determinand where it is inapplicable.","SELECT D.record_id
FROM dataset_74231.""aggregateddatabywaterbody"" as D
INNER JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'AggregatedDataByWaterBody'
    AND ""loqmandatory"" = -1
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE D.""procedureloqvalue"" IS NOT NULL
  AND D.""procedureloqvalue""  <> ''
  AND (
    D.""resultobservationstatus"" NOT IN ('Z')
    OR D.""resultobservationstatus"" IS NULL
   OR D.""resultobservationstatus"" = ''
  )","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","procedureLOQValue","02a1_conflict_procedureLOQValue_inapplicable_reported","Conflicting values test - procedureLOQValue - inapplicable reported","Tests that the procedureLOQValue is not reported for determinands for which it is inapplicable.","The procedureLOQValue is reported for a determinand where it is inapplicable.","SELECT D.record_id
FROM dataset_74231.""aggregateddatabywaterbody"" as D
INNER JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'AggregatedDataByWaterBody'
    AND ""loqmandatory"" = -1
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE D.""procedureloqvalue"" IS NOT NULL
AND D.""procedureloqvalue"" <>''
  AND (
    D.""resultobservationstatus"" NOT IN ('Z')
    OR D.""resultobservationstatus"" IS NULL
    OR D.""resultobservationstatus"" = ''
  )","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","procedureLOQValue","09a_limit_procedureLOQvalue_acceptable","Value limit test - procedureLOQvalue - acceptable limits","Tests that the procedureLOQvalue follows acceptable limits for the respective observed property determinands.","The reported procedureLOQvalue is outside the acceptable limits ({%minoperator%}{%limitminloq%} and {%maxoperator%}{%limitmaxloq%}).","SELECT rep.record_id 
  ,CASE refer.""limitminloqinclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  ,CASE refer.""limitmaxloqinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' 
  END AS maxoperator 
  ,refer.""limitminloq"" 
  ,refer.""limitmaxloq"" 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') <>'Z'
  AND refer.""tablename"" = 'AggregatedDataByWaterBody'
  AND rep.""procedureloqvalue"" IS NOT NULL 
  AND rep.""procedureloqvalue"" <>''
  AND (
    ( 
      refer.""limitminloqqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitminloqinclusive"" = '1' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitminloq"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitminloqinclusive"" = '0' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitminloq"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxloqqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxloqinclusive"" = '1' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmaxloq"" AS NUMERIC(32,16))) 
        OR ( refer.""limitmaxloqinclusive"" = '0' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmaxloq"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","procedureLOQValue","09b_limit_procedureLOQvalue_expected","Value limit test - procedureLOQvalue - expected range","Tests that the procedureLOQvalue is within the commonly expected range for the respective observed property determinands.","The reported procedureLOQvalue is outside the commonly expected range ({%minoperator%}{%limitminloq%} and {%maxoperator%}{%limitmaxloq%}).","SELECT rep.record_id 
  ,CASE refer.""limitminloqinclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  ,CASE refer.""limitmaxloqinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' 
  END AS maxoperator 
  ,refer.""limitminloq"" 
  ,refer.""limitmaxloq"" 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') <>'Z'
  AND refer.""tablename"" = 'AggregatedDataByWaterBody'
  AND rep.""procedureloqvalue"" IS NOT NULL 
  AND rep.""procedureloqvalue"" <> ''
  AND (
    ( 
      refer.""limitminloqqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitminloqinclusive"" = '1' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitminloq"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitminloqinclusive"" = '0' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitminloq"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxloqqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxloqinclusive"" = '1' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmaxloq"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxloqinclusive"" = '0' AND CAST(rep.""procedureloqvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmaxloq"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","WARNING","false","true","true"
"AggregatedDataByWaterBody","resultQualityNumberOfSamplesBelowLOQ","01f1_mandatory_resultQualityNumberOfSamplesBelowLOQ_determinand_missing","Mandatory resultQualityNumberOfSamplesBelowLOQ determinand test - missing unjustified","Tests that the resultQualityNumberOfSamplesBelowLOQ is reported for determinands where it is mandatory, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The resultQualityNumberOfSamplesBelowLOQ is mandatory for the reported determinand, but it is missing without a proper justification.","SELECT D.record_id
FROM dataset_74231.""aggregateddatabywaterbody"" as D
LEFT JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'AggregatedDataByWaterBody'
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE (D.""resultqualitynumberofsamplesbelowloq"" IS NULL or D.""resultqualitynumberofsamplesbelowloq"" = '')
  AND R.""loqmandatory"" = 1
  AND (
    D.""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR D.""resultobservationstatus"" IS NULL
    OR D.""resultobservationstatus"" = ''
  )","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","resultQualityNumberOfSamplesBelowLOQ","01f2_mandatory_resultQualityNumberOfSamplesBelowLOQ_belowLOQ_missing","Mandatory resultQualityNumberOfSamplesBelowLOQ BelowLOQ test - missing unjustified","Tests that the resultQualityNumberOfSamplesBelowLOQ is reported if any of the BelowLOQ flags is true, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z'), or if LOQ is inapplicable for the reported determinand.","The resultQualityNumberOfSamplesBelowLOQ is mandatory because at least one of the BelowLOQ flags is true, but it is missing without a proper justification.","SELECT D.record_id
FROM dataset_74231.""aggregateddatabywaterbody"" as D
LEFT JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'AggregatedDataByWaterBody'
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE (D.""resultqualitynumberofsamplesbelowloq"" IS NULL or D.""resultqualitynumberofsamplesbelowloq"" = '')
  AND (
    ""resultqualityminimumbelowloq"" = '1'
    OR  ""resultqualitymeanbelowloq"" = '1'
    OR  ""resultqualitymaximumbelowloq"" = '1'
    OR  ""resultqualitymedianbelowloq"" = '1'
  )
  AND R.""loqmandatory"" <> -1
  AND (
    D.""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR D.""resultobservationstatus"" IS NULL
    OR D.""resultobservationstatus"" = ''
  )","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","resultQualityNumberOfSamplesBelowLOQ","02a1_conflict_resultQualityNumberOfSamplesBelowLOQ_inapplicable_reported","Conflicting values test - resultQualityNumberOfSamplesBelowLOQ - inapplicable reported","Tests that the resultQualityNumberOfSamplesBelowLOQ is not reported for determinands for which it is inapplicable.","The resultQualityNumberOfSamplesBelowLOQ is reported for a determinand where it is inapplicable.","SELECT D.record_id
FROM dataset_74231.""aggregateddatabywaterbody"" as D
INNER JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'AggregatedDataByWaterBody'
    AND ""loqmandatory"" = -1
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE (D.""resultqualitynumberofsamplesbelowloq"" IS NOT NULL and D.""resultqualitynumberofsamplesbelowloq"" <> '')
  AND (
    D.""resultobservationstatus"" NOT IN ('Z')
    OR D.""resultobservationstatus"" IS NULL
OR D.""resultobservationstatus""  =''
  )","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","resultQualityNumberOfSamplesBelowLOQ","07b_constraints_resultQualityNumberOfSamplesBelowLOQ","Value constraints test - resultQualityNumberOfSamplesBelowLOQ","Tests that values match the constraints specified in dataset definitions: resultQualityNumberOfSamplesBelowLOQ >= 0","The value fails the rule: resultQualityNumberOfSamplesBelowLOQ >= 0","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ISNUMERIC( ""resultqualitynumberofsamplesbelowloq"")
  AND CAST(""resultqualitynumberofsamplesbelowloq"" AS NUMERIC(32,16)) < 0","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","resultNumberOfSitesClass4","02d_conflict_determinand_class4","Conflicting values test - determinand - Class4","Tests that the resultNumberOfSitesClass4 is not reported for these determinands: Dissolved oxygen.","The resultNumberOfSitesClass4 is not eligible for this determinand.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultnumberofsitesclass4"" IS NOT NULL
AND ""resultnumberofsitesclass4"" <>''
  AND ""observedpropertydeterminandcode"" = 'EEA_3132-01-2'","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","resultNumberOfSitesClass5","02d_conflict_determinand_class5","Conflicting values test - determinand - Class5","Tests that the resultNumberOfSitesClass5 is not reported for these determinands: Dissolved oxygen, Ammonium, Nitrate.","The resultNumberOfSitesClass5 is not eligible for this determinand.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultnumberofsitesclass5"" IS NOT NULL
AND ""resultnumberofsitesclass5"" <>''
  AND ""observedpropertydeterminandcode"" IN ('EEA_3132-01-2','CAS_14798-03-9','CAS_14797-55-8')","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","resultMeanValue","08a2_limit_resultMeanValue_acceptable","Value limit test - resultMeanValue - acceptable limits","Tests that the resultMeanValue follows acceptable limits for the respective observed property determinands.","The reported resultMeanValue is outside the acceptable limits ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') <>'Z'
  AND refer.""tablename"" = 'AggregatedDataByWaterBody'
  AND rep.""resultmeanvalue"" IS NOT NULL 
AND  rep.""resultmeanvalue"" <>''
  AND (
    ( 
      refer.""limitminqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","resultMeanValue","08b2_limit_resultMeanValue_expected","Value limit test - resultMeanValue - expected range","Tests that the resultMeanValue is within the commonly expected range for the respective observed property determinands.","The reported resultMeanValue is outside the the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') NOT IN ('Z','A')
  AND refer.""tablename"" = 'AggregatedDataByWaterBody'
  AND rep.""resultmeanvalue"" IS NOT NULL 
AND rep.""resultmeanvalue"" <>''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16))) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16))) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","WARNING","false","true","true"
"AggregatedDataByWaterBody","resultMeanValue","08c2_limit_resultMeanValue_confirmed","Value limit test - resultMeanValue - confirmed outlier","Detects records with confirmed resultMeanValue outside the commonly expected range for the respective observed property determinands.","The reported resultMeanValue is a confirmed outlier outside the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE rep.""resultobservationstatus""='A'
  AND refer.""tablename"" = 'AggregatedDataByWaterBody'
  AND rep.""resultmeanvalue"" IS NOT NULL 
  AND rep.""resultmeanvalue"" <> ''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmeanvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","INFO","false","true","true"
"AggregatedDataByWaterBody","resultMaximumValue","08a3_limit_resultMaximumValue_acceptable","Value limit test - resultMaximumValue - acceptable limits","Tests that the resultMaximumValue follows acceptable limits for the respective observed property determinands.","The reported resultMaximumValue is outside the acceptable limits ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') <>'Z'
  AND refer.""tablename"" = 'AggregatedDataByWaterBody'
  AND rep.""resultmaximumvalue"" IS NOT NULL
AND rep.""resultmaximumvalue""<>'' 
  AND (
    ( 
      refer.""limitminqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","resultMaximumValue","08b3_limit_resultMaximumValue_expected","Value limit test - resultMaximumValue - expected range","Tests that the resultMaximumValue is within the commonly expected range for the respective observed property determinands.","The reported resultMaximumValue is outside the the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') NOT IN ('Z','A')
  AND refer.""tablename"" = 'AggregatedDataByWaterBody'
  AND rep.""resultmaximumvalue"" IS NOT NULL 
AND rep.""resultmaximumvalue"" <>''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16))< CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16))) 
      )
    )
  )","FIELD","WARNING","false","true","true"
"AggregatedDataByWaterBody","resultMaximumValue","08c3_limit_resultMaximumValue_confirmed","Value limit test - resultMaximumValue - confirmed outlier","Detects records with confirmed resultMaximumValue outside the commonly expected range for the respective observed property determinands.","The reported resultMaximumValue is a confirmed outlier outside the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE rep.""resultobservationstatus""='A'
  AND refer.""tablename"" = 'AggregatedDataByWaterBody'
  AND rep.""resultmaximumvalue"" IS NOT NULL 
  AND rep.""resultmaximumvalue""<>''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmaximumvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","INFO","false","true","true"
"AggregatedDataByWaterBody","procedureAnalysedMatrix","06b_coherence_procedureAnalysedMatrix","Coherence test - procedureAnalysedMatrix","Tests that table contains only Water data.","Biota and Sediment data can not be reported in this table.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody"" 
WHERE LEFT(""procedureanalysedmatrix"", 1) <> 'W'","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","parameterWaterBodyCategory","06c_coherence_parameterWaterBodyCategory","Coherence test - parameterWaterBodyCategory","Tests that the data is reported only from groundwater bodies (parameterWaterBodyCategory = 'GW')","Only groundwater data can be reported in this table.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
AND ""parameterwaterbodycategory"" <>'GW'","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","resultStandardDeviationValue","07c_constraints_resultStandardDeviationValue","Value constraints test - resultStandardDeviationValue","Tests that values match the constraints specified in dataset definitions: resultStandardDeviationValue >= 0","The value fails the rule: resultStandardDeviationValue >= 0","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ISNUMERIC(""resultstandarddeviationvalue"")
  AND CAST(""resultstandarddeviationvalue"" AS NUMERIC(32,16)) < 0","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","phenomenonTimeReferenceYear","07e_constraints_phenomenonTimeReferenceYear","Value constraints test - phenomenonTimeReferenceYear","Tests that phenomenonTimeReferenceYear value is within the expected range.","The phenomenonTimeReferenceYear is outside the expected range.","WITH 
refYear as (
  SELECT n.""metadatavalueinteger"" as yearMin 
    , x.""metadatavalueinteger"" as yearMax 
  FROM dataset_74232.""dataflowmetadata"" as n 
  CROSS JOIN dataset_74232.""dataflowmetadata"" as x 
  WHERE n.""metadatacode"" = 'referenceYearMin' 
  AND x.""metadatacode"" = 'referenceYearMax' 
) 

SELECT record_id 
FROM dataset_74231.""aggregateddatabywaterbody"" as d 
CROSS JOIN refYear 
WHERE d.""phenomenontimereferenceyear"" < refYear.yearMin 
  OR d.""phenomenontimereferenceyear""> refYear.yearMax","FIELD","WARNING","false","true","true"
"AggregatedDataByWaterBody","resultMinimumValue","08a1_limit_resultMinimumValue_acceptable","Value limit test - resultMinimumValue - acceptable limits","Tests that the resultMinimumValue follows acceptable limits for the respective observed property determinands.","The reported resultMinimumValue is outside the acceptable limits ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') <>'Z'
  AND refer.""tablename"" = 'AggregatedDataByWaterBody'
  AND rep.""resultminimumvalue"" IS NOT NULL 
AND rep.""resultminimumvalue"" <>''
  AND (
    ( 
      refer.""limitminqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16))) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16))) 
      )
    )
  )","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","resultMinimumValue","08b1_limit_resultMinimumValue_expected","Value limit test - resultMinimumValue - expected range","Tests that the resultMinimumValue is within the commonly expected range for the respective observed property determinands.","The reported resultMinimumValue is outside the the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') NOT IN ('Z','A')
  AND refer.""tablename"" = 'AggregatedDataByWaterBody'
  AND rep.""resultminimumvalue"" IS NOT NULL 
AND rep.""resultminimumvalue"" <>''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16))) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16))) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16))) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","WARNING","false","true","true"
"AggregatedDataByWaterBody","resultMinimumValue","08c1_limit_resultMinimumValue_confirmed","Value limit test - resultMinimumValue - confirmed outlier","Detects records with confirmed resultMinimumValue outside the commonly expected range for the respective observed property determinands.","The reported resultMinimumValue is a confirmed outlier outside the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE rep.""resultobservationstatus""='A'
  AND refer.""tablename"" = 'AggregatedDataByWaterBody'
  AND rep.""resultminimumvalue"" IS NOT NULL 
AND rep.""resultminimumvalue""<>''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) < CAST(refer.""limitmin"" AS NUMERIC(32,16))) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16))) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultminimumvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","INFO","false","true","true"
"AggregatedDataByWaterBody","resultMedianValue","08a4_limit_resultMedianValue_acceptable","Value limit test - resultMedianValue - acceptable limits","Tests that the resultMedianValue follows acceptable limits for the respective observed property determinands.","The reported resultMedianValue is outside the acceptable limits ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') <>'Z'
  AND refer.""tablename"" = 'AggregatedDataByWaterBody'
  AND rep.""resultmedianvalue"" IS NOT NULL 
  AND rep.""resultmedianvalue""  <> ''
  AND (
    ( 
      refer.""limitminqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16))< CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" = 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16))) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","resultMedianValue","08b4_limit_resultMedianValue_expected","Value limit test - resultMedianValue - expected range","Tests that the resultMedianValue is within the commonly expected range for the respective observed property determinands.","The reported resultMedianValue is outside the the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE COALESCE(rep.""resultobservationstatus"",'') NOT IN ('Z','A')
  AND refer.""tablename"" = 'AggregatedDataByWaterBody'
  AND rep.""resultmedianvalue"" IS NOT NULL 
AND rep.""resultmedianvalue"" <> ''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16))< CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) >= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","WARNING","false","true","true"
"AggregatedDataByWaterBody","resultMedianValue","08c4_limit_resultMedianValue_confirmed","Value limit test - resultMedianValue - confirmed outlier","Detects records with confirmed resultMedianValue outside the commonly expected range for the respective observed property determinands.","The reported resultMedianValue is a confirmed outlier outside the commonly expected range ({%minoperator%}{%limitmin%} and {%maxoperator%}{%limitmax%}).","SELECT rep.record_id 
  , CASE refer.""limitmininclusive"" 
    WHEN '1' THEN '>=' 
    ELSE '>' 
  END AS minoperator 
  , CASE refer.""limitmaxinclusive"" 
    WHEN '1' THEN '<=' 
    ELSE '<' END AS maxoperator 
  , refer.""limitmin"" 
  , refer.""limitmax"" 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
INNER JOIN dataset_74232.""observedproperty_qc_reference"" as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE rep.""resultobservationstatus""='A'
  AND refer.""tablename"" = 'AggregatedDataByWaterBody'
  AND rep.""resultmedianvalue"" IS NOT NULL 
AND rep.""resultmedianvalue""  <> ''
  AND (
    ( 
      refer.""limitminqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmininclusive"" = '1' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16))< CAST(refer.""limitmin"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmininclusive"" = '0' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) <= CAST(refer.""limitmin"" AS NUMERIC(32,16))) 
      )
    ) 
    OR ( 
      refer.""limitmaxqclevel"" <> 'BLOCKER' 
      AND ( 
        ( refer.""limitmaxinclusive"" = '1' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16)) > CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
        OR ( refer.""limitmaxinclusive"" = '0' AND CAST(rep.""resultmedianvalue"" AS NUMERIC(32,16))>= CAST(refer.""limitmax"" AS NUMERIC(32,16)) ) 
      )
    )
  )","FIELD","INFO","false","true","true"
"DisaggregatedData","","01e_mandatory_results_missing_justified","Mandatory value tests - missing result values justified","Detects records with missing mandatory result values which are justified by the appropriate flag in the resultObservationStatus field.","Justification has been provided for some missing values.","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE (
    ""resultuom"" IS NULL
    OR ""resultuom"" =''
    OR ""resultobservedvalue"" is NULL
    OR ""resultobservedvalue"" =''
    OR ""resultqualityobservedvaluebelowloq"" IS NULL
    OR ""resultqualityobservedvaluebelowloq"" =''
    OR ""procedureloqvalue"" IS NULL
    OR ""procedureloqvalue"" =''
  )
  AND ""resultobservationstatus"" IN ('L','M','N','O','Z') ","RECORD","INFO","false","true","true"
"DisaggregatedData","","02c2_conflict_non-biota","Conflicting values test - Biota specific values in non-Biota records","Tests that the Biota specific values (parameterSpecies, resultMoisture, resultFat, resultExtractableLipid, resultLipid) are reported only in Biota records.","Some of the Biota specific values are reported for non-Biota record.","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE ""resultobservationstatus"" NOT IN ('Z')
  AND (
    (""parameterspecies"" IS NOT NULL AND ""parameterspecies""<>'')
    OR (""resultmoisture"" IS NOT NULL AND ""resultmoisture"" <>'')
    OR (""resultfat"" IS NOT NULL AND""resultfat"" <>'')
    OR (""resultextractablelipid"" IS NOT NULL AND""resultextractablelipid""<>'')
    OR (""resultlipid"" IS NOT NULL AND ""resultlipid"" <>'')
    
    
    
  )
  AND LEFT(""procedureanalysedmatrix"",1) <> 'B'","RECORD","BLOCKER","false","true","true"
"DisaggregatedData","","03a_uniqueness_water","Record uniqueness test - Water","Tests the uniqueness of the Water records. The following combination of values must be unique with no duplicate records existing: monitoringSiteIdentifier, monitoringSiteIdentifierScheme, observedPropertyDeterminandCode, procedureAnalysedMatrix, sampleIdentifier, phenomenonTimeSamplingDate.","The Water record is not unique.","WITH 
a AS (
  SELECT *
    ,ROW_NUMBER() OVER ( 
      PARTITION BY ""monitoringsiteidentifier"", ""monitoringsiteidentifierscheme"", ""parameterwaterbodycategory"", ""observedpropertydeterminandcode"", ""procedureanalysedmatrix"", ""phenomenontimesamplingdate"", ""sampleidentifier""
      ORDER BY ""monitoringsiteidentifier"", ""monitoringsiteidentifierscheme"", ""parameterwaterbodycategory"", ""observedpropertydeterminandcode"", ""procedureanalysedmatrix"", ""phenomenontimesamplingdate"", ""sampleidentifier""
    ) AS r
  FROM dataset_74231.""disaggregateddata""
  WHERE LEFT(""procedureanalysedmatrix"",1) = 'W'
)

, b AS (
  SELECT ""monitoringsiteidentifier"", ""monitoringsiteidentifierscheme"", ""parameterwaterbodycategory"", ""observedpropertydeterminandcode"", ""procedureanalysedmatrix"", ""phenomenontimesamplingdate"", ""sampleidentifier"" 
  FROM a 
  WHERE r <> 1
)

SELECT d.record_id
FROM dataset_74231.""disaggregateddata"" as d
INNER JOIN b
  ON d.""monitoringsiteidentifier"" = b.""monitoringsiteidentifier""
  AND d.""monitoringsiteidentifierscheme"" = b.""monitoringsiteidentifierscheme""
  AND d.""parameterwaterbodycategory"" = b.""parameterwaterbodycategory""
  AND d.""observedpropertydeterminandcode"" = b.""observedpropertydeterminandcode""
  AND d.""procedureanalysedmatrix"" = b.""procedureanalysedmatrix""
  AND d.""phenomenontimesamplingdate"" = b.""phenomenontimesamplingdate""
  AND d.""sampleidentifier""  = b.""sampleidentifier""","RECORD","BLOCKER","false","true","true"
"DisaggregatedData","","03b_uniqueness_biota","Record uniqueness test - Biota","Tests the uniqueness of the Biota records. The following combination of values must be unique with no duplicate records existing: monitoringSiteIdentifier, monitoringSiteIdentifierScheme, observedPropertyDeterminandCode, procedureAnalysedMatrix, sampleIdentifier, phenomenonTimeSamplingDate, parameterSpecies.","The Biota record is not unique.","WITH 
a AS (
  SELECT *
    ,ROW_NUMBER() OVER ( 
      PARTITION BY ""monitoringsiteidentifier"", ""monitoringsiteidentifierscheme"", ""parameterwaterbodycategory"", ""observedpropertydeterminandcode"", ""procedureanalysedmatrix"", ""phenomenontimesamplingdate"", ""sampleidentifier"", ""parameterspecies""
      ORDER BY ""monitoringsiteidentifier"", ""monitoringsiteidentifierscheme"", ""parameterwaterbodycategory"", ""observedpropertydeterminandcode"", ""procedureanalysedmatrix"", ""phenomenontimesamplingdate"", ""sampleidentifier"", ""parameterspecies""
    ) AS r
  FROM dataset_74231.""disaggregateddata""
  WHERE LEFT(""procedureanalysedmatrix"",1) = 'B'
)

, b AS (
  SELECT ""monitoringsiteidentifier"", ""monitoringsiteidentifierscheme"", ""parameterwaterbodycategory"", ""observedpropertydeterminandcode"", ""procedureanalysedmatrix"", ""phenomenontimesamplingdate"", ""sampleidentifier"", ""parameterspecies""
  FROM a 
  WHERE r <> 1
)

SELECT d.record_id
FROM dataset_74231.""disaggregateddata"" as d
INNER JOIN b
  ON d.""monitoringsiteidentifier"" = b.""monitoringsiteidentifier""
  AND d.""monitoringsiteidentifierscheme"" = b.""monitoringsiteidentifierscheme""
  AND d.""parameterwaterbodycategory"" = b.""parameterwaterbodycategory""
  AND d.""observedpropertydeterminandcode"" = b.""observedpropertydeterminandcode""
  AND d.""procedureanalysedmatrix"" = b.""procedureanalysedmatrix""
  AND d.""phenomenontimesamplingdate"" = b.""phenomenontimesamplingdate""
  AND d.""sampleidentifier""  = b.""sampleidentifier""
  AND d.""parameterspecies"" = b.""parameterspecies""","RECORD","BLOCKER","false","true","true"
"DisaggregatedData","","03c_uniqueness_sediment","Record uniqueness test - Sediment","Tests the uniqueness of the Sediment records. The following combination of values must be unique with no duplicate records existing: monitoringSiteIdentifier, monitoringSiteIdentifierScheme, observedPropertyDeterminandCode, procedureAnalysedMatrix, sampleIdentifier, phenomenonTimeSamplingDate, parameterSedimentDepthSampled.","The Sediment record is not unique.","WITH 
a AS (
  SELECT *
    ,ROW_NUMBER() OVER ( 
      PARTITION BY ""monitoringsiteidentifier"", ""monitoringsiteidentifierscheme"", ""parameterwaterbodycategory"", ""observedpropertydeterminandcode"", ""procedureanalysedmatrix"", ""phenomenontimesamplingdate"", ""sampleidentifier"", COALESCE(""parametersedimentdepthsampled"",'')
      ORDER BY ""monitoringsiteidentifier"", ""monitoringsiteidentifierscheme"", ""parameterwaterbodycategory"", ""observedpropertydeterminandcode"", ""procedureanalysedmatrix"", ""phenomenontimesamplingdate"", ""sampleidentifier"", COALESCE(""parametersedimentdepthsampled"",'')
    ) AS r
  FROM dataset_74231.""disaggregateddata""
  WHERE LEFT(""procedureanalysedmatrix"",1) = 'S'
)

, b AS (
  SELECT ""monitoringsiteidentifier"", ""monitoringsiteidentifierscheme"", ""parameterwaterbodycategory"", ""observedpropertydeterminandcode"", ""procedureanalysedmatrix"", ""phenomenontimesamplingdate"", ""sampleidentifier"", ""parametersedimentdepthsampled""
  FROM a 
  WHERE r <> 1
)

SELECT d.*
FROM dataset_74231.""disaggregateddata"" as d
INNER JOIN b
  ON d.""monitoringsiteidentifier"" = b.""monitoringsiteidentifier""
  AND d.""monitoringsiteidentifierscheme"" = b.""monitoringsiteidentifierscheme""
  AND d.""parameterwaterbodycategory"" = b.""parameterwaterbodycategory""
  AND d.""observedpropertydeterminandcode"" = b.""observedpropertydeterminandcode""
  AND d.""procedureanalysedmatrix"" = b.""procedureanalysedmatrix""
  AND d.""phenomenontimesamplingdate"" = b.""phenomenontimesamplingdate""
  AND d.""sampleidentifier""  = b.""sampleidentifier""
  AND COALESCE(d.""parametersedimentdepthsampled"",'') = COALESCE(b.""parametersedimentdepthsampled"",'')","RECORD","BLOCKER","false","true","true"
"DisaggregatedData","","04c_spatialIdentifier_reference","Monitoring site identifier test - reference","Tests that the reported monitoringSiteIdentifier and monitoringSiteIdentifierScheme combination is present in the reference dataset. Only the valid, retired and deprecated identifiers are accepted. Superseded or non-existing are not.","The reported monitoring site identifier is not present in the reference dataset.","SELECT rep.record_id 
FROM dataset_74231.""disaggregateddata"" as rep 
LEFT JOIN ( 
  SELECT * 
  FROM dataset_74232.""spatialidentifier""
  WHERE ""statuscode"" IN ('valid','stable','experimental','retired','deprecated') 
) as refer 
  ON rep.""monitoringsiteidentifier"" = refer.""spatialidentifier"" 
  AND rep.""monitoringsiteidentifierscheme"" = refer.""spatialidentifierscheme"" 
WHERE refer.""spatialidentifier"" IS NULL or refer.""spatialidentifier"" = ''","RECORD","BLOCKER","false","true","true"
"DisaggregatedData","","04d_spatialIdentifier_deprecated","Monitoring site identifier test - retired and deprecated identifiers","Detects records with retired or deprecated monitoring site identifiers.","The reported monitoring site identifier is retired or deprecated in the spatial reference dataset.","SELECT rep.record_id 
FROM dataset_74231.""disaggregateddata"" as rep 
INNER JOIN ( 
  SELECT * 
  FROM dataset_74232.""spatialidentifier""
  WHERE ""statuscode"" IN ('retired','deprecated') 
) as refer 
  ON rep.""monitoringsiteidentifier"" = refer.""spatialidentifier"" 
  AND rep.""monitoringsiteidentifierscheme"" = refer.""spatialidentifierscheme"" ","RECORD","INFO","false","true","true"
"DisaggregatedData","","04e_spatialIdentifier_waterBodyCategory","Monitoring site identifier test - water body category","Tests that the reported parameterWaterBodyCategory matches the category (specialisedZoneType) of the water body, to which the respective monitoring site is officially assigned, as reported in the WFD or WISE-5 reporting.","The parameterWaterBodyCategory do not match the officially reported water body data","SELECT rep.record_id 
FROM dataset_74231.""disaggregateddata"" as rep 
INNER JOIN ( 
  SELECT * 
  FROM dataset_74232.""spatialidentifier""
  WHERE ""statuscode"" IN ('valid','stable','experimental','retired','deprecated') 
) as refer 
  ON rep.""monitoringsiteidentifier"" = refer.""spatialidentifier"" 
  AND rep.""monitoringsiteidentifierscheme"" = refer.""spatialidentifierscheme"" 
WHERE ""resultobservationstatus"" NOT IN ('Z')
  AND rep.""parameterwaterbodycategory"" <> refer.""parameterwaterbodycategory""","RECORD","ERROR","false","true","true"
"DisaggregatedData","","07c_constraints_biotaResultValues","Value constraints test - biota specific result values","Tests that Biota specific result values match the constraints specified in dataset definitions: result value >= 0 and <= 100","Some of the biota specific result values fail the rule: >= 0 and <= 100","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND (
    (""resultmoisture"" <>'' and (CAST(""resultmoisture"" AS NUMERIC(32,16))< 0
    OR CAST(""resultmoisture"" AS NUMERIC(32,16)) > 100))
    OR (""resultfat""<>'' and (CAST(""resultfat"" AS NUMERIC(32,16)) < 0
    OR CAST(""resultfat"" AS NUMERIC(32,16)) > 100))
    OR (""resultextractablelipid""<>'' and (CAST(""resultextractablelipid"" AS NUMERIC(32,16)) < 0
    OR CAST(""resultextractablelipid"" AS NUMERIC(32,16)) > 100))
    OR (""resultlipid""<>'' and (CAST(""resultlipid"" AS NUMERIC(32,16)) < 0
    OR CAST(""resultlipid"" AS NUMERIC(32,16)) >= 100))
  )","RECORD","BLOCKER","false","true","true"
"AggregatedData","","01c_mandatory_belowLOQ_missing","Mandatory BelowLOQ flag test - missing unjustified","Tests that all BelowLOQ flags are reported, if their absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","Some of the BelowLOQ flags are missing without a proper justification in the resultObservationStatus field.","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE (
    ""resultqualityminimumbelowloq"" IS NULL
    OR  ""resultqualitymeanbelowloq"" IS NULL
    OR  ""resultqualitymaximumbelowloq"" IS NULL
    OR  ""resultqualitymedianbelowloq"" IS NULL
    OR ""resultqualityminimumbelowloq""  =  ''
    OR  ""resultqualitymeanbelowloq""  = ''
    OR  ""resultqualitymaximumbelowloq""  = ''
    OR  ""resultqualitymedianbelowloq"" = ''
  )
  AND (
   ""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR ""resultobservationstatus"" IS NULL
    OR ""resultobservationstatus"" =''
  )","RECORD","BLOCKER","false","true","true"
"AggregatedData","","01d_mandatory_resultStatistics_missing","Mandatory result Statistics values test - missing unjustified","Tests that all result Statistics values are reported, if their absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z') or if the corresponding BelowLOQ flag = True.","The resultObservedValue is missing without a proper justification.","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE 
  (
    ( (""resultminimumvalue"" IS NULL or ""resultminimumvalue"" = '') AND ( ""resultqualityminimumbelowloq"" = '0' OR ""resultqualityminimumbelowloq"" IS NULL or ""resultqualityminimumbelowloq"" ='' ))
	OR ( (""resultmeanvalue"" IS NULL or ""resultmeanvalue"" = '') AND ( ""resultqualitymeanbelowloq"" = '0' OR ""resultqualitymeanbelowloq"" IS NULL OR ""resultqualitymeanbelowloq"" = ''))
	OR ( (""resultmaximumvalue"" IS NULL or  ""resultmaximumvalue"" = '') AND ( ""resultqualitymaximumbelowloq"" = '0' OR ""resultqualitymaximumbelowloq"" IS NULL OR ""resultqualitymaximumbelowloq"" = ''))
	OR ( (""resultmedianvalue"" IS NULL or ""resultmedianvalue"" = '') AND ( ""resultqualitymedianbelowloq"" = '0' OR ""resultqualitymedianbelowloq"" IS NULL OR ""resultqualitymedianbelowloq"" = ''))
  ) AND (
    ""resultobservationstatus"" NOT IN ('L','M','N','O','Z') OR ""resultobservationstatus"" IS NULL OR ""resultobservationstatus"" = ''
  )","RECORD","BLOCKER","false","true","true"
"AggregatedData","","01g_mandatory_results_missing_justified","Mandatory value tests - missing result values justified","Detects records with missing mandatory result values which are justified by the appropriate flag in the resultObservationStatus field.","Justification has been provided for some missing values.","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE 
  (
    ( (""resultminimumvalue"" IS NULL or ""resultminimumvalue"" = '') AND ( ""resultqualityminimumbelowloq"" = '0' OR ""resultqualityminimumbelowloq"" IS NULL OR ""resultqualityminimumbelowloq"" =''))
	OR ( (""resultmeanvalue"" IS NULL or ""resultmeanvalue""  ='') AND ( ""resultqualitymeanbelowloq"" =  '0' OR ""resultqualitymeanbelowloq"" IS NULL OR ""resultqualitymeanbelowloq"" =''))
	OR ( (""resultmaximumvalue"" IS NULL or ""resultmaximumvalue"" = '') AND ( ""resultqualitymaximumbelowloq"" =  '0' OR ""resultqualitymaximumbelowloq"" IS NULL OR ""resultqualitymaximumbelowloq"" =''))
	OR ( (""resultmedianvalue"" IS NULL or  ""resultmedianvalue"" = '') AND ( ""resultqualitymedianbelowloq"" =  '0' OR ""resultqualitymedianbelowloq"" IS NULL OR ""resultqualitymedianbelowloq""=''))
  ) 
AND ""resultobservationstatus"" IN ('L','M','N','O','Z') ","RECORD","INFO","false","true","true"
"AggregatedData","","02b2_conflict_justified_missing_resultStatistics_reported","Conflicting values test - missing values justified - result Statistics values reported","Test that all the result Statistics fields are empty if it is justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","Some of the result Statistics values are reported although a justification for missing result values is provided.","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE (
    ""resultminimumvalue"" IS NULL
    OR ""resultmeanvalue"" IS NULL
    OR ""resultmaximumvalue"" IS NULL
    OR ""resultmedianvalue"" IS NULL
    OR ""resultminimumvalue"" =''
    OR ""resultmeanvalue""  =''
    OR ""resultmaximumvalue""  =''
    OR ""resultmedianvalue""  =''
  )
  AND ""resultobservationstatus"" IN ('L','M','N','O','Z')","RECORD","WARNING","false","true","true"
"AggregatedData","","02c_conflict_belowLOQ_LOQinapplicable","Conflicting values test - BelowLOQ - inapplicable LOQ","Tests that all the BelowLOQ flags are False for determinands where LOQ is inapplicable.","Some of the BelowLOQ flags are True for a determinand where it is inapplicable.","SELECT D.record_id
FROM dataset_74231.""aggregateddata"" as D
INNER JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'AggregatedData'
    AND ""loqmandatory"" = -1
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE ( 
    D.""resultqualityminimumbelowloq"" <> '0'
    OR D.""resultqualitymeanbelowloq"" <> '0'
    OR D.""resultqualitymaximumbelowloq"" <> '0'
    OR D.""resultqualitymedianbelowloq"" <> '0'
  )
  AND (
    D.""resultobservationstatus"" NOT IN ('Z')
    OR D.""resultobservationstatus"" IS NULL
    OR D.""resultobservationstatus""=''
  )","RECORD","BLOCKER","false","true","true"
"AggregatedData","","04c_spatialIdentifier_reference","Monitoring site identifier test - reference","Tests that the reported monitoringSiteIdentifier and monitoringSiteIdentifierScheme combination is present in the reference dataset. Only the valid, retired and deprecated identifiers are accepted. Superseded or non-existing are not.","The reported monitoring site identifier is not present in the reference dataset.","SELECT rep.record_id 
FROM dataset_74231.""aggregateddata"" as rep 
LEFT JOIN ( 
  SELECT * 
  FROM dataset_74232.""spatialidentifier""
  WHERE ""statuscode"" IN ('valid','stable','experimental','retired','deprecated') 
) as refer 
  ON rep.""monitoringsiteidentifier"" = refer.""spatialidentifier"" 
  AND rep.""monitoringsiteidentifierscheme"" = refer.""spatialidentifierscheme"" 
WHERE refer.""spatialidentifier"" IS NULL or refer.""spatialidentifier""=''","RECORD","BLOCKER","false","true","true"
"AggregatedData","","04d_spatialIdentifier_deprecated","Monitoring site identifier test - retired and deprecated identifiers","Detects records with retired or deprecated monitoring site identifiers.","The reported monitoring site identifier is retired or deprecated in the spatial reference dataset.","SELECT rep.record_id 
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN ( 
  SELECT * 
  FROM dataset_74232.""spatialidentifier""
  WHERE ""statuscode"" IN ('retired','deprecated') 
) as refer 
  ON rep.""monitoringsiteidentifier"" = refer.""spatialidentifier"" 
  AND rep.""monitoringsiteidentifierscheme"" = refer.""spatialidentifierscheme""","RECORD","INFO","false","true","true"
"AggregatedData","","04e_spatialIdentifier_waterBodyCategory","Monitoring site identifier test - water body category","Tests that the reported parameterWaterBodyCategory matches the category (specialisedZoneType) of the water body, to which the respective monitoring site is officially assigned, as reported in the WFD or WISE-5 reporting.","The parameterWaterBodyCategory do not match the officially reported water body data","SELECT rep.record_id 
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN ( 
  SELECT * 
  FROM dataset_74232.""spatialidentifier""
  WHERE ""statuscode"" IN ('valid','stable','experimental','retired','deprecated') 
) as refer 
  ON rep.""monitoringsiteidentifier"" = refer.""spatialidentifier"" 
  AND rep.""monitoringsiteidentifierscheme"" = refer.""spatialidentifierscheme"" 
WHERE ""resultobservationstatus"" NOT IN ('Z')
  AND rep.""parameterwaterbodycategory"" <> refer.""parameterwaterbodycategory""","RECORD","ERROR","false","true","true"
"AggregatedData","","10a02_logic_result_rule2","Logical coherence test - result values - rule 2","Tests logical coherence rule: resultMaximumValue >= resultMeanValue","The record fails this logical coherence rule: resultMaximumValue >= resultMeanValue","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
AND ISNUMERIC(""resultmaximumvalue"")
AND ISNUMERIC(""resultmeanvalue"")
AND CAST(""resultmaximumvalue"" AS NUMERIC(32,16)) < CAST(""resultmeanvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10a03_logic_result_rule3","Logical coherence test - result values - rule 3","Tests logical coherence rule: resultMedianValue >= resultMinimumValue","The record fails this logical coherence rule: resultMedianValue >= resultMinimumValue","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
AND ISNUMERIC(""resultmedianvalue"")
AND ISNUMERIC(""resultminimumvalue"")
  AND CAST(""resultmedianvalue"" AS NUMERIC(32,16)) < CAST(""resultminimumvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10a04_logic_result_rule4","Logical coherence test - result values - rule 4","Tests logical coherence rule: resultMaximumValue >= resultMedianValue","The record fails this logical coherence rule: resultMaximumValue >= resultMedianValue","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
AND ISNUMERIC(""resultmaximumvalue"")
AND ISNUMERIC(""resultmedianvalue"")
  AND CAST(""resultmaximumvalue"" AS NUMERIC(32,16)) < CAST(""resultmedianvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10a05_logic_result_rule5","Logical coherence test - result values - rule 5","Tests logical coherence rule: resultMaximumValue >= resultMinimumValue","The record fails this logical coherence rule: resultMaximumValue >= resultMinimumValue","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
AND ISNUMERIC(""resultmaximumvalue"")
AND ISNUMERIC(""resultminimumvalue"")
  AND CAST(""resultmaximumvalue"" AS NUMERIC(32,16)) < CAST(""resultminimumvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10a06_logic_result_rule6","Logical coherence test - result values - rule 6","Tests logical coherence rule: resultStandardDeviationValue <= (resultMaximumValue - resultMinimumValue)","The record fails this logical coherence rule: resultStandardDeviationValue <= (resultMaximumValue - resultMinimumValue)","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"", '') <> 'Z'
AND ISNUMERIC(""resultstandarddeviationvalue"")
AND ISNUMERIC(""resultmaximumvalue"")
AND ISNUMERIC(""resultminimumvalue"")
  AND CAST(""resultstandarddeviationvalue"" AS NUMERIC(32,16)) > (CAST(""resultmaximumvalue"" AS NUMERIC(32,16))  - CAST(""resultminimumvalue"" AS NUMERIC(32,16)))","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10a07_logic_result_rule7","Logical coherence test - result values - rule 7","Tests logical coherence rule: IF resultMinimumValue < resultMaximumValue THEN resultStandardDeviationValue > 0","The record fails this logical coherence rule: IF resultMinimumValue < resultMaximumValue THEN resultStandardDeviationValue > 0","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"", '') <> 'Z'
AND ISNUMERIC(""resultminimumvalue"")
AND ISNUMERIC(""resultmaximumvalue"")
AND ISNUMERIC(""resultstandarddeviationvalue"")
AND CAST(""resultminimumvalue"" AS NUMERIC(32,16)) < CAST(""resultmaximumvalue"" AS NUMERIC(32,16))
 AND CAST(""resultstandarddeviationvalue"" AS NUMERIC(32,16)) = 0","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10a08_logic_result_rule8","Logical coherence test - result values - rule 8","Tests logical coherence rule: IF resultNumberOfSamples = 1 THEN resultMinimumValue = resultMeanValue = resultMaximumValue = resultMedianValue","The record fails this logical coherence rule: IF resultNumberOfSamples = 1 THEN resultMinimumValue = resultMeanValue = resultMaximumValue = resultMedianValue","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ISNUMERIC(""resultnumberofsamples"") AND ""resultnumberofsamples"" = 1 
  AND (
    ( ISNUMERIC(""resultminimumvalue"") AND ISNUMERIC(""resultmeanvalue"") AND ""resultminimumvalue"" <> ""resultmeanvalue"" )
    OR ( ISNUMERIC(""resultmeanvalue"") AND ISNUMERIC(""resultmaximumvalue"") AND ""resultmeanvalue"" <> ""resultmaximumvalue"" )
    OR (ISNUMERIC(""resultmaximumvalue"") AND ISNUMERIC(""resultmedianvalue"") AND ""resultmaximumvalue"" <> ""resultmedianvalue"")
  )","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10a09_logic_result_rule9","Logical coherence test - result values - rule 9","Tests logical coherence rule: IF resultNumberOfSamples = 1 THEN resultStandardDeviationValue = 0","The record fails this logical coherence rule: IF resultNumberOfSamples = 1 THEN resultStandardDeviationValue = 0","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"", '') <> 'Z'
  AND ISNUMERIC(""resultnumberofsamples"") AND CAST(""resultnumberofsamples"" AS NUMERIC(32,16)) = 1
  AND ISNUMERIC(""resultStandardDeviationValue"") 
  AND CAST(""resultStandardDeviationValue"" AS NUMERIC(32,16)) <> 0","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10a11_logic_result_rule11","Logical coherence test - result values - rule 11","Tests logical coherence rule: IF resultQualityNumberOfSamplesBelowLOQ = 0 THEN resultQualityMinimumBelowLOQ = resultQualityMeanBelowLOQ = resultQualityMaximumBelowLOQ = resultQualityMedianBelowLOQ = False","The record fails this logical coherence rule: IF resultQualityNumberOfSamplesBelowLOQ = 0 THEN resultQualityMinimumBelowLOQ = resultQualityMeanBelowLOQ = resultQualityMaximumBelowLOQ = resultQualityMedianBelowLOQ = False","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ISNUMERIC(""resultqualitynumberofsamplesbelowloq"")
  AND CAST(""resultqualitynumberofsamplesbelowloq"" AS NUMERIC(32,16)) = 0
  AND (
    ""resultqualityminimumbelowloq"" <> '0' 
    OR ""resultqualitymeanbelowloq"" <> '0'
    OR ""resultqualitymaximumbelowloq"" <> '0'
    OR ""resultqualitymedianbelowloq"" <> '0'
  )","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10a12_logic_result_rule12","Logical coherence test - result values - rule 12","Tests logical coherence rule: IF resultNumberOfSamples = 1 THEN resultQualityMinimumBelowLOQ = resultQualityMeanBelowLOQ = resultQualityMaximumBelowLOQ = resultQualityMedianBelowLOQ","The record fails this logical coherence rule: IF resultNumberOfSamples = 1 THEN resultQualityMinimumBelowLOQ = resultQualityMeanBelowLOQ = resultQualityMaximumBelowLOQ = resultQualityMedianBelowLOQ","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ISNUMERIC(""resultnumberofsamples"")
  AND CAST(""resultnumberofsamples"" AS NUMERIC(32,16)) = 1
  AND (
    (ISNUMERIC(""resultqualityminimumbelowloq"") AND ISNUMERIC(""resultqualitymeanbelowloq"") AND CAST(""resultqualityminimumbelowloq"" AS NUMERIC(32,16)) <> CAST(""resultqualitymeanbelowloq"" AS NUMERIC(32,16)))
    OR ( ISNUMERIC(""resultqualitymeanbelowloq"") AND ISNUMERIC(""resultqualitymaximumbelowloq"") AND CAST(""resultqualitymeanbelowloq"" AS NUMERIC(32,16)) <> CAST(""resultqualitymaximumbelowloq"" AS NUMERIC(32,16)) )
    OR (ISNUMERIC(""resultqualitymaximumbelowloq"") AND ISNUMERIC(""resultqualitymedianbelowloq"") AND CAST(""resultqualitymaximumbelowloq"" AS NUMERIC(32,16)) <> CAST(""resultqualitymedianbelowloq"" AS NUMERIC(32,16)))
  )","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10a13_logic_result_rule13","Logical coherence test - result values - rule 13","Tests logical coherence rule: IF resultQualityNumberOfSamplesBelowLOQ = resultNumberOfSamples THEN resultQualityMinimumBelowLOQ =  resultQualityMeanBelowLOQ = resultQualityMaximumBelowLOQ = resultQualityMedianBelowLOQ = True","The record fails logical coherence rule: IF resultQualityNumberOfSamplesBelowLOQ = resultNumberOfSamples THEN resultQualityMinimumBelowLOQ =  resultQualityMeanBelowLOQ = resultQualityMaximumBelowLOQ = resultQualityMedianBelowLOQ = True","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualitynumberofsamplesbelowloq"" = ""resultnumberofsamples""
  AND (
    ""resultqualityminimumbelowloq"" <> '1' 
    OR ""resultqualitymeanbelowloq"" <> '1'
    OR ""resultqualitymaximumbelowloq"" <> '1'
    OR ""resultqualitymedianbelowloq"" <> '1'
  )","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","01c_mandatory_belowLOQ_missing","Mandatory BelowLOQ flag test - missing unjustified","Tests that all BelowLOQ flags are reported, if their absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","Some of the BelowLOQ flags are missing without a proper justification in the resultObservationStatus field.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE (
    ""resultqualityminimumbelowloq"" IS NULL
    OR ""resultqualityminimumbelowloq"" = ''
    OR  ""resultqualitymeanbelowloq"" IS NULL
    OR  ""resultqualitymeanbelowloq"" =''
    OR  ""resultqualitymaximumbelowloq"" IS NULL
    OR  ""resultqualitymaximumbelowloq"" = ''
    OR  ""resultqualitymedianbelowloq"" IS NULL
    OR  ""resultqualitymedianbelowloq"" = ''
  )
  AND (
   ""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR ""resultobservationstatus"" IS NULL
    OR ""resultobservationstatus"" = ''
  )","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","01d_mandatory_resultStatistics_missing","Mandatory result Statistics values test - missing unjustified","Tests that all result Statistics values are reported, if their absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z') or if the corresponding BelowLOQ flag = True.","The resultObservedValue is missing without a proper justification.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE 
  (
    ( (""resultminimumvalue""  IS NULL or  ""resultminimumvalue"" ='') AND ( ""resultqualityminimumbelowloq"" = '0' OR ""resultqualityminimumbelowloq"" IS NULL or ""resultqualityminimumbelowloq""='' ))
	OR ( (""resultmeanvalue"" IS NULL or ""resultmeanvalue"" ='') AND ( ""resultqualitymeanbelowloq"" = '0' OR ""resultqualitymeanbelowloq"" IS NULL OR ""resultqualitymeanbelowloq""=''))
	OR ( (""resultmaximumvalue"" IS NULL or  ""resultmaximumvalue"" ='') AND ( ""resultqualitymaximumbelowloq"" = '0' OR ""resultqualitymaximumbelowloq"" IS NULL OR ""resultqualitymaximumbelowloq"" ='' ))
	OR (( ""resultmedianvalue"" IS NULL or  ""resultmedianvalue""='') AND ( ""resultqualitymedianbelowloq"" = '0' OR ""resultqualitymedianbelowloq"" IS NULL OR ""resultqualitymedianbelowloq""=''))
  ) AND (
    ""resultobservationstatus"" NOT IN ('L','M','N','O','Z') OR ""resultobservationstatus"" IS NULL OR ""resultobservationstatus"" =''
  )","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","01g_mandatory_results_missing_justified","Mandatory value tests - missing result values justified","Detects records with missing mandatory result values which are justified by the appropriate flag in the resultObservationStatus field.","Justification has been provided for some missing values.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE 
  (
    ( (""resultminimumvalue"" IS NULL OR ""resultminimumvalue"" = '') AND 
      (""resultqualityminimumbelowloq"" = '0' OR ""resultqualityminimumbelowloq"" IS NULL OR ""resultqualityminimumbelowloq"" = '') )
    OR ( (""resultmeanvalue"" IS NULL OR ""resultmeanvalue"" = '') AND 
         (""resultqualitymeanbelowloq"" = '0' OR ""resultqualitymeanbelowloq"" IS NULL OR ""resultqualitymeanbelowloq"" = '') )
    OR ( (""resultmaximumvalue"" IS NULL OR ""resultmaximumvalue"" = '') AND 
         (""resultqualitymaximumbelowloq"" = '0' OR ""resultqualitymaximumbelowloq"" IS NULL OR ""resultqualitymaximumbelowloq"" = '') )
    OR ( (""resultmedianvalue"" IS NULL OR ""resultmedianvalue"" = '') AND 
         (""resultqualitymedianbelowloq"" = '0' OR ""resultqualitymedianbelowloq"" IS NULL OR ""resultqualitymedianbelowloq"" = '') )
  ) 
AND ""resultobservationstatus"" IN ('L', 'M', 'N', 'O', 'Z')","RECORD","INFO","false","true","true"
"AggregatedDataByWaterBody","","02b2_conflict_justified_missing_resultStatistics_reported","Conflicting values test - missing values justified - result Statistics values reported","Test that all the result Statistics fields are empty if it is justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","Some of the result Statistics values are reported although a justification for missing result values is provided.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE (
    ""resultminimumvalue"" IS NULL OR ""resultminimumvalue"" = ''
    OR ""resultmeanvalue"" IS NULL OR ""resultmeanvalue"" = ''
    OR ""resultmaximumvalue"" IS NULL OR ""resultmaximumvalue"" = ''
    OR ""resultmedianvalue"" IS NULL OR ""resultmedianvalue"" = ''
  )
  AND ""resultobservationstatus"" IN ('L', 'M', 'N', 'O', 'Z')","RECORD","WARNING","false","true","true"
"AggregatedDataByWaterBody","","02b3_conflict_justified_missing_belowLOQ_reported","Conflicting values test - missing values justified - BelowLOQ reported","Test that all the BelowLOQ fields are empty if it is justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","Some of the BelowLOQ flags are reported although a justification for missing result values is provided.","SELECT a.record_id
FROM dataset_74231.""aggregateddatabywaterbody"" a
WHERE (
    ""resultqualityminimumbelowloq"" IS NULL OR ""resultqualityminimumbelowloq"" = ''
    OR ""resultqualitymeanbelowloq"" IS NULL OR ""resultqualitymeanbelowloq"" = ''
    OR ""resultqualitymaximumbelowloq"" IS NULL OR ""resultqualitymaximumbelowloq"" = ''
    OR ""resultqualitymedianbelowloq"" IS NULL OR ""resultqualitymedianbelowloq"" = ''
  )
  AND ""resultobservationstatus"" IN ('L', 'M', 'N', 'O', 'Z')","RECORD","WARNING","false","true","true"
"AggregatedDataByWaterBody","","02c_conflict_belowLOQ_LOQinapplicable","Conflicting values test - BelowLOQ - inapplicable LOQ","Tests that all the BelowLOQ flags are False for determinands where LOQ is inapplicable.","Some of the BelowLOQ flags are True for a determinand where it is inapplicable.","SELECT D.record_id
FROM dataset_74231.""aggregateddatabywaterbody"" as D
INNER JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'AggregatedDataByWaterBody'
    AND ""loqmandatory"" = -1
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE ( 
    D.""resultqualityminimumbelowloq"" <> '0'
    OR D.""resultqualitymeanbelowloq"" <> '0'
    OR D.""resultqualitymaximumbelowloq"" <> '0'
    OR D.""resultqualitymedianbelowloq"" <> '0'
  )
  AND (
    D.""resultobservationstatus"" NOT IN ('Z')
    OR D.""resultobservationstatus"" IS NULL
   OR D.""resultobservationstatus"" = ''
  )","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","04c_spatialIdentifier_reference","Water body identifier test - reference","Tests that the reported waterBodyIdentifier and waterBodyIdentifierScheme combination is present in the reference dataset. Only the valid identifiers are accepted. Superseded, retired or non-existing are not.","The reported water body identifier is not present in the reference dataset.","SELECT rep.record_id 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
LEFT JOIN ( 
  SELECT * 
  FROM dataset_74232.""spatialidentifier""
  WHERE ""statuscode"" IN ('valid','stable','experimental','retired','deprecated') 
) as refer 
  ON rep.""waterbodyidentifier"" = refer.""spatialidentifier"" 
  AND rep.""waterbodyidentifierscheme"" = refer.""spatialidentifierscheme"" 
WHERE refer.""spatialidentifier"" IS NULL or refer.""spatialidentifier"" =''","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","04e_spatialIdentifier_waterBodyCategory","Water body identifier test - water body category","Tests that the reported parameterWaterBodyCategory matches the category (specialisedZoneType) of the water body, as reported in the WFD or WISE-5 reporting.","The parameterWaterBodyCategory do not match the officially reported water body data","SELECT rep.record_id 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
INNER JOIN ( 
  SELECT * 
  FROM dataset_74232.""spatialidentifier""
  WHERE ""statuscode"" IN ('valid','stable','experimental','retired','deprecated') 
) as refer 
  ON rep.""waterbodyidentifier"" = refer.""spatialidentifier"" 
  AND rep.""waterbodyidentifierscheme"" = refer.""spatialidentifierscheme"" 
WHERE ""resultobservationstatus"" NOT IN ('Z')
  AND rep.""parameterwaterbodycategory"" <> refer.""parameterwaterbodycategory""","RECORD","ERROR","false","true","true"
"AggregatedDataByWaterBody","","10a01_logic_result_rule1","Logical coherence test - result values - rule 1","Tests logical coherence rule: resultMeanValue >= resultMinimumValue","The record fails logical coherence rule: resultMeanValue >= resultMinimumValue","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
AND ISNUMERIC(""resultmeanvalue"")
AND ISNUMERIC(""resultminimumvalue"")
 AND CAST(""resultmeanvalue"" AS NUMERIC(32,16)) < CAST(""resultminimumvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10a02_logic_result_rule2","Logical coherence test - result values - rule 2","Tests logical coherence rule: resultMaximumValue >= resultMeanValue","The record fails logical coherence rule: resultMaximumValue >= resultMeanValue","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
AND ISNUMERIC(""resultmaximumvalue"")
AND ISNUMERIC(""resultmeanvalue"")
AND CAST(""resultmaximumvalue"" AS NUMERIC(32,16)) < CAST(""resultmeanvalue"" AS NUMERIC(32,16))
","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10a03_logic_result_rule3","Logical coherence test - result values - rule 3","Tests logical coherence rule: resultMedianValue >= resultMinimumValue","The record fails logical coherence rule: resultMedianValue >= resultMinimumValue","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
AND ISNUMERIC(""resultmedianvalue"")
AND ISNUMERIC(""resultminimumvalue"")
AND CAST(""resultmedianvalue"" AS NUMERIC(32,16)) < CAST(""resultminimumvalue"" AS NUMERIC(32,16))
","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10a04_logic_result_rule4","Logical coherence test - result values - rule 4","Tests logical coherence rule: resultMaximumValue >= resultMedianValue","The record fails logical coherence rule: resultMaximumValue >= resultMedianValue","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
AND ISNUMERIC(""resultmaximumvalue"")
AND ISNUMERIC(""resultmedianvalue"")
  AND CAST(""resultmaximumvalue"" AS NUMERIC(32,16)) < CAST(""resultmedianvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10a05_logic_result_rule5","Logical coherence test - result values - rule 5","Tests logical coherence rule: resultMaximumValue >= resultMinimumValue","The record fails logical coherence rule: resultMaximumValue >= resultMinimumValue","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
AND ISNUMERIC(""resultmaximumvalue"")
AND ISNUMERIC(""resultminimumvalue"")
  AND CAST(""resultmaximumvalue"" AS NUMERIC(32,16)) < CAST(""resultminimumvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10a06_logic_result_rule6","Logical coherence test - result values - rule 6","Tests logical coherence rule: resultStandardDeviationValue <= (resultMaximumValue - resultMinimumValue)","The record fails logical coherence rule: resultStandardDeviationValue <= (resultMaximumValue - resultMinimumValue)","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"", '') <> 'Z'
AND ISNUMERIC(""resultstandarddeviationvalue"")
AND ISNUMERIC(""resultmaximumvalue"")
AND ISNUMERIC(""resultminimumvalue"")
  AND CAST(""resultstandarddeviationvalue"" AS NUMERIC(32,16)) > (CAST(""resultmaximumvalue"" AS NUMERIC(32,16))  - CAST(""resultminimumvalue"" AS NUMERIC(32,16)))","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10a07_logic_result_rule7","Logical coherence test - result values - rule 7","Tests logical coherence rule: IF resultMinimumValue < resultMaximumValue THEN resultStandardDeviationValue > 0","The record fails logical coherence rule: IF resultMinimumValue < resultMaximumValue THEN resultStandardDeviationValue > 0","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"", '') <> 'Z'
AND ISNUMERIC(""resultminimumvalue"")
AND ISNUMERIC(""resultmaximumvalue"")
AND ISNUMERIC(""resultstandarddeviationvalue"")
AND CAST(""resultminimumvalue"" AS NUMERIC(32,16)) < CAST(""resultmaximumvalue"" AS NUMERIC(32,16))
 AND CAST(""resultstandarddeviationvalue"" AS NUMERIC(32,16)) = 0","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10a08_logic_result_rule8","Logical coherence test - result values - rule 8","Tests logical coherence rule: IF resultNumberOfSamples = 1 THEN resultMinimumValue = resultMeanValue = resultMaximumValue = resultMedianValue","The record fails logical coherence rule: IF resultNumberOfSamples = 1 THEN resultMinimumValue = resultMeanValue = resultMaximumValue = resultMedianValue","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ISNUMERIC(""resultnumberofsamples"") AND ""resultnumberofsamples"" = 1 
  AND (
    ( ISNUMERIC(""resultminimumvalue"") AND ISNUMERIC(""resultmeanvalue"") AND ""resultminimumvalue"" <> ""resultmeanvalue"" )
    OR ( ISNUMERIC(""resultmeanvalue"") AND ISNUMERIC(""resultmaximumvalue"") AND ""resultmeanvalue"" <> ""resultmaximumvalue"" )
    OR (ISNUMERIC(""resultmaximumvalue"") AND ISNUMERIC(""resultmedianvalue"") AND ""resultmaximumvalue"" <> ""resultmedianvalue"")
  )","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10a09_logic_result_rule9","Logical coherence test - result values - rule 9","Tests logical coherence rule: IF resultNumberOfSamples = 1 THEN resultStandardDeviationValue = 0","The record fails logical coherence rule: IF resultNumberOfSamples = 1 THEN resultStandardDeviationValue = 0","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"", '') <> 'Z'
AND ISNUMERIC(""resultnumberofsamples"") AND CAST(""resultnumberofsamples"" AS NUMERIC(32,16)) = 1
AND ISNUMERIC(""resultStandardDeviationValue"") 
AND CAST(""resultStandardDeviationValue"" AS NUMERIC(32,16)) <> 0","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10a11_logic_result_rule11","Logical coherence test - result values - rule 11","Tests logical coherence rule: IF resultQualityNumberOfSamplesBelowLOQ = 0 THEN resultQualityMinimumBelowLOQ = resultQualityMeanBelowLOQ = resultQualityMaximumBelowLOQ = resultQualityMedianBelowLOQ = False","The record fails logical coherence rule: IF resultQualityNumberOfSamplesBelowLOQ = 0 THEN resultQualityMinimumBelowLOQ = resultQualityMeanBelowLOQ = resultQualityMaximumBelowLOQ = resultQualityMedianBelowLOQ = False","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ISNUMERIC(""resultqualitynumberofsamplesbelowloq"")
  AND CAST(""resultqualitynumberofsamplesbelowloq"" AS NUMERIC(32,16)) = 0
  AND (
    ""resultqualityminimumbelowloq"" <> '0' 
    OR ""resultqualitymeanbelowloq"" <> '0'
    OR ""resultqualitymaximumbelowloq"" <> '0'
    OR ""resultqualitymedianbelowloq"" <> '0'
  )

","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10a12_logic_result_rule12","Logical coherence test - result values - rule 12","Tests logical coherence rule: IF resultNumberOfSamples = 1 THEN resultQualityMinimumBelowLOQ = resultQualityMeanBelowLOQ = resultQualityMaximumBelowLOQ = resultQualityMedianBelowLOQ","The record fails logical coherence rule: IF resultNumberOfSamples = 1 THEN resultQualityMinimumBelowLOQ = resultQualityMeanBelowLOQ = resultQualityMaximumBelowLOQ = resultQualityMedianBelowLOQ","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ISNUMERIC(""resultnumberofsamples"")
  AND CAST(""resultnumberofsamples"" AS NUMERIC(32,16)) = 1
  AND (
    (ISNUMERIC(""resultqualityminimumbelowloq"") AND ISNUMERIC(""resultqualitymeanbelowloq"") AND CAST(""resultqualityminimumbelowloq"" AS NUMERIC(32,16)) <> CAST(""resultqualitymeanbelowloq"" AS NUMERIC(32,16)))
    OR ( ISNUMERIC(""resultqualitymeanbelowloq"") AND ISNUMERIC(""resultqualitymaximumbelowloq"") AND CAST(""resultqualitymeanbelowloq"" AS NUMERIC(32,16)) <> CAST(""resultqualitymaximumbelowloq"" AS NUMERIC(32,16)) )
    OR (ISNUMERIC(""resultqualitymaximumbelowloq"") AND ISNUMERIC(""resultqualitymedianbelowloq"") AND CAST(""resultqualitymaximumbelowloq"" AS NUMERIC(32,16)) <> CAST(""resultqualitymedianbelowloq"" AS NUMERIC(32,16)))
  )","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10a13_logic_result_rule13","Logical coherence test - result values - rule 13","Tests logical coherence rule: IF resultQualityNumberOfSamplesBelowLOQ = resultNumberOfSamples THEN resultQualityMinimumBelowLOQ =  resultQualityMeanBelowLOQ = resultQualityMaximumBelowLOQ = resultQualityMedianBelowLOQ = True","The record fails logical coherence rule: IF resultQualityNumberOfSamplesBelowLOQ = resultNumberOfSamples THEN resultQualityMinimumBelowLOQ =  resultQualityMeanBelowLOQ = resultQualityMaximumBelowLOQ = resultQualityMedianBelowLOQ = True","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualitynumberofsamplesbelowloq"" = ""resultnumberofsamples""
  AND (
    ""resultqualityminimumbelowloq"" <> '1' 
    OR ""resultqualitymeanbelowloq"" <> '1'
    OR ""resultqualitymaximumbelowloq"" <> '1'
    OR ""resultqualitymedianbelowloq"" <> '1'
  )","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10c_logic_numberOfSitesClass_total","Logical coherence test - total number of sites in classes","Tests that the total numbers of sites reported in all classes doesn't exceed the resultNumberOfSamples value.","The sum of number of sites reported in all classes exceeds the resultNumberOfSamples value.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"", '') <> 'Z'
 AND ""resultnumberofsamples"" <> ''
and ISNUMERIC(""resultnumberofsitesclass1"")
and ISNUMERIC(""resultnumberofsitesclass2"")
and ISNUMERIC(""resultnumberofsitesclass3"")
and ISNUMERIC(""resultnumberofsitesclass4"")
and ISNUMERIC(""resultnumberofsitesclass5"")
  AND CAST(""resultnumberofsamples"" AS DECIMAL) < 
      COALESCE(""resultnumberofsitesclass1"", 0) +
      COALESCE(""resultnumberofsitesclass2"", 0) +
      COALESCE(""resultnumberofsitesclass3"" , 0) +
      COALESCE(""resultnumberofsitesclass4"" , 0) +
      COALESCE(""resultnumberofsitesclass5"" , 0)","RECORD","BLOCKER","false","true","true"
"AggregatedData","","02b3_conflict_justified_missing_belowLOQ_reported","Conflicting values test - missing values justified - BelowLOQ reported","Test that all the BelowLOQ fields are empty if it is justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","Some of the BelowLOQ flags are reported although a justification for missing result values is provided.","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE (
    ""resultqualityminimumbelowloq"" IS NULL
    OR ""resultqualityminimumbelowloq""= ''
    OR ""resultqualitymeanbelowloq"" IS NULL
    OR ""resultqualitymeanbelowloq""  =''
    OR ""resultqualitymaximumbelowloq"" IS NULL
    OR ""resultqualitymaximumbelowloq"" = ''
    OR ""resultqualitymedianbelowloq"" IS NULL
    OR ""resultqualitymedianbelowloq"" =''
  )
  AND ""resultobservationstatus"" IN ('L','M','N','O','Z')","RECORD","WARNING","false","true","true"
"AggregatedDataByWaterBody","resultUom","01a_mandatory_resultUom_missing","Mandatory resultUom test - missing unjustified","Tests that the resultUom is reported, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The resultUom is missing without a proper justification in the resultObservationStatus field.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE (""resultuom"" IS NULL or ""resultuom"" ='')
  AND (
    ""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR ""resultobservationstatus"" IS NULL
    OR ""resultobservationstatus""=''
  )","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","resultNumberOfSamples","01b_mandatory_resultNumberOfSamples_missing","Mandatory resultNumberOfSamples test - missing unjustified","Tests that the resultNumberOfSamples is reported, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The resultObservedValue is missing without a proper justification.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE (""resultnumberofsamples"" IS NULL or ""resultnumberofsamples"" ='')
  AND (
    ""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR ""resultobservationstatus"" IS NULL
OR ""resultobservationstatus""=''
  )","FIELD","BLOCKER","false","true","true"
"AggregatedData","","10a01_logic_result_rule1","Logical coherence test - result values - rule 1","Tests logical coherence rule: resultMeanValue >= resultMinimumValue","The record fails this logical coherence rule: resultMeanValue >= resultMinimumValue","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
AND ISNUMERIC(""resultmeanvalue"")
AND ISNUMERIC(""resultminimumvalue"")
 AND CAST(""resultmeanvalue"" AS NUMERIC(32,16)) < CAST(""resultminimumvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"DisaggregatedData","observedPropertyDeterminandCode","05_observedProperty_unexpected","Observed property test - unexpected","Tests that the observedPropertyDeterminandCode values are expected to be reported in this table.","The observedPropertyDeterminandCode is not an expected one for this table.","SELECT rep.record_id 
FROM dataset_74231.""disaggregateddata"" as rep 
LEFT JOIN (
  SELECT ""observedpropertydeterminandcode"" , ""procedureanalysedmatrix""
  FROM dataset_74232.""observedproperty_qc_reference"" 
  WHERE tableName = 'DisaggregatedData'
) as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE refer.""observedpropertydeterminandcode"" IS NULL ","FIELD","WARNING","false","true","true"
"DisaggregatedData","resultUom","06_coherence_observedProperty_uom","Coherence test - observedPropertyDeterminandCode and resultUom ","Tests that the reported resultUom value is correct for the reported observedPropertyDeterminandCode.","The reported resultUom is not correct for the observedPropertyDeterminandCode. The correct one is '{%correct_uom%}'.","SELECT rep.record_id, refer.resultUom as correct_uom
FROM dataset_74231.""disaggregateddata"" as rep 
INNER JOIN (
  SELECT ""observedpropertydeterminandcode"", ""resultuom"" , ""procedureanalysedmatrix"" 
  FROM dataset_74232.""observedproperty_qc_reference"" 
  WHERE tableName = 'DisaggregatedData'
) as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE rep.""resultuom"" IS NOT NULL and rep.""resultuom"" <>''
  AND rep.""resultuom"" <> refer.""resultuom""","FIELD","BLOCKER","false","true","true"
"AggregatedData","observedPropertyDeterminandCode","05_observedProperty_unexpected","Observed property test - unexpected","Tests that the observedPropertyDeterminandCode values are expected to be reported in this table.","The observedPropertyDeterminandCode is not an expected one for this table.","SELECT rep.record_id 
FROM dataset_74231.""aggregateddata"" as rep 
LEFT JOIN (
  SELECT ""observedpropertydeterminandcode"" , ""procedureanalysedmatrix"" 
  FROM dataset_74232.""observedproperty_qc_reference"" 
  WHERE tableName = 'AggregatedData'
) as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE refer.""observedpropertydeterminandcode"" IS NULL","FIELD","WARNING","false","true","true"
"AggregatedDataByWaterBody","procedureLOQValue","01e1_mandatory_procedureLOQValue_determinand_missing","Mandatory procedureLOQValue determinand test - missing unjustified","Tests that the procedureLOQValue is reported for determinands where it is mandatory, if its absence is not justified by an appropriate resultObservationStatus flag ('L','M','N','O','Z').","The procedureLOQValue is mandatory for the reported determinand, but it is missing without a proper justification.","SELECT D.record_id
FROM dataset_74231.""aggregateddatabywaterbody"" as D
LEFT JOIN (
  SELECT *
  FROM dataset_74232.""observedproperty_qc_reference""
  WHERE ""tablename"" = 'AggregatedDataByWaterBody'
) as R
  ON D.""observedpropertydeterminandcode"" = R.""observedpropertydeterminandcode""
  AND LEFT(D.""procedureanalysedmatrix"",1) = R.""procedureanalysedmatrix""
WHERE (D.""procedureloqvalue"" IS NULL OR D.""procedureloqvalue"" ='')
  AND R.""loqmandatory"" = 1
  AND (
    D.""resultobservationstatus"" NOT IN ('L','M','N','O','Z')
    OR D.""resultobservationstatus"" IS NULL
    OR D.""resultobservationstatus""=''
  )","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","observedPropertyDeterminandCode","05_observedProperty_unexpected","Observed property test - unexpected","Tests that the observedPropertyDeterminandCode values are expected to be reported in this table.","The observedPropertyDeterminandCode is not an expected one for this table.","SELECT rep.record_id 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
LEFT JOIN (
  SELECT ""observedpropertydeterminandcode"" , ""procedureanalysedmatrix""
  FROM dataset_74232.""observedproperty_qc_reference"" 
  WHERE tableName = 'AggregatedDataByWaterBody'
) as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE refer.""observedpropertydeterminandcode"" IS NULL or  refer.""observedpropertydeterminandcode""=''","FIELD","WARNING","false","true","true"
"AggregatedData","parameterSamplingPeriod","07f1_constraints_parameterSamplingPeriod_format","Value constraints test - parameterSamplingPeriod - format","Tests that the parameterSamplingPeriod is provided in the requested format (YYYY-MM-DD--YYYY-MM-DD or YYYY-MM--YYYY-MM).","The parameterSamplingPeriod doesn't have a correct format.","( parameterSamplingPeriod MATCH ""[\d]{4}-[\d]{2}-[\d]{2}--[\d]{4}-[\d]{2}-[\d]{2}"" ) OR ( parameterSamplingPeriod MATCH ""[\d]{4}-[\d]{2}--[\d]{4}-[\d]{2}"" )","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","parameterSamplingPeriod","07f1_constraints_parameterSamplingPeriod_format","Value constraints test - parameterSamplingPeriod - format","Tests that the parameterSamplingPeriod is provided in the requested format (YYYY-MM-DD--YYYY-MM-DD or YYYY-MM--YYYY-MM).","The parameterSamplingPeriod doesn't have a correct format.","( parameterSamplingPeriod MATCH ""[\d]{4}-[\d]{2}-[\d]{2}--[\d]{4}-[\d]{2}-[\d]{2}"" ) OR ( parameterSamplingPeriod MATCH ""[\d]{4}-[\d]{2}--[\d]{4}-[\d]{2}"" )","FIELD","BLOCKER","false","true","true"
"AggregatedData","","10a10_logic_result_rule10","Logical coherence test - result values - rule 10","Tests logical coherence rule: resultQualityNumberOfSamplesBelowLOQ <= resultNumberOfSamples","The record fails this logical coherence rule: resultQualityNumberOfSamplesBelowLOQ <= resultNumberOfSamples","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
AND ISNUMERIC(""resultqualitynumberofsamplesbelowloq"")
AND ISNUMERIC(""resultnumberofsamples"")
  AND CAST(""resultqualitynumberofsamplesbelowloq"" AS NUMERIC(32,16)) > CAST(""resultnumberofsamples"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10a10_logic_result_rule10","Logical coherence test - result values - rule 10","Tests logical coherence rule: resultQualityNumberOfSamplesBelowLOQ <= resultNumberOfSamples","The record fails logical coherence rule: resultQualityNumberOfSamplesBelowLOQ <= resultNumberOfSamples","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
AND ISNUMERIC(""resultqualitynumberofsamplesbelowloq"")
AND ISNUMERIC(""resultnumberofsamples"")
  AND CAST(""resultqualitynumberofsamplesbelowloq"" AS NUMERIC(32,16)) > CAST(""resultnumberofsamples"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"DisaggregatedData","","10a_logic_belowLOQ_false","Logical coherence test - resultQualityObservedValueBelowLOQ - False","Tests that there are no records where resultObservedValue < procedureLOQValue if resultQualityObservedValueBelowLOQ = False.","Although the resultQualityObservedValueBelowLOQ = False, the reported resultObservedValue is lower than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualityobservedvaluebelowloq"" = '0'
  AND ISNUMERIC(""resultobservedvalue"") 
  AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultobservedvalue"" AS NUMERIC(32,16)) < CAST(""procedureloqvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"DisaggregatedData","","10a_logic_belowLOQ_true","Logical coherence test - resultQualityObservedValueBelowLOQ - True","Tests that there are no records where resultObservedValue > procedureLOQValue if resultQualityObservedValueBelowLOQ = True.","Although the resultQualityObservedValueBelowLOQ = True, the reported resultObservedValue is higher than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""disaggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualityobservedvaluebelowloq"" = '1'
AND ISNUMERIC(""resultobservedvalue"")
AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultobservedvalue"" AS NUMERIC(32,16)) > CAST(""procedureloqvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10b1_logic_belowLOQ_false_minimum","Logical coherence test - resultQualityMinimumBelowLOQ - False","Tests that there are no records where resultMinimumValue < procedureLOQValue if resultQualityMinimumBelowLOQ = False.","Although the resultQualityMinimumBelowLOQ = False, the reported resultMinimumValue is lower than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualityminimumbelowloq"" = '0'
AND ISNUMERIC(""resultminimumvalue"")
AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultminimumvalue"" AS NUMERIC(32,16))< CAST(""procedureloqvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10b2_logic_belowLOQ_false_mean","Logical coherence test - resultQualityMeanBelowLOQ - False","Tests that there are no records where resultMeanValue < procedureLOQValue if resultQualityMeanBelowLOQ = False.","Although the resultQualityMeanBelowLOQ = False, the reported resultMeanValue is lower than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualitymeanbelowloq"" = '0'
AND ISNUMERIC(""resultmeanvalue"" )
AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultmeanvalue"" AS NUMERIC(32,16)) < CAST(""procedureloqvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10b3_logic_belowLOQ_false_maximum","Logical coherence test - resultQualityMaximumBelowLOQ - False","Tests that there are no records where resultMaximumValue < procedureLOQValue if resultQualityMaximumBelowLOQ = False.","Although the resultQualityMaximumBelowLOQ = False, the reported resultMaximumValue is lower than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualitymaximumbelowloq"" = '0'
AND ISNUMERIC(""resultmaximumvalue"")
AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultmaximumvalue"" AS NUMERIC(32,16)) < CAST(""procedureloqvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10b4_logic_belowLOQ_false_median","Logical coherence test - resultQualityMedianBelowLOQ - False","Tests that there are no records where resultMedianValue < procedureLOQValue if resultQualityMedianBelowLOQ = False.","Although the resultQualityMedianBelowLOQ = False, the reported resultMedianValue is lower than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualitymedianbelowloq"" = '0'
AND ISNUMERIC(""resultmedianvalue"")
AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultmedianvalue"" AS NUMERIC(32,16))< CAST(""procedureloqvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10b1_logic_belowLOQ_true_minimum","Logical coherence test - resultQualityMinimumBelowLOQ - True","Tests that there are no records where resultMinimumValue > procedureLOQValue if resultQualityMinimumBelowLOQ = True.","Although the resultQualityMinimumBelowLOQ = True, the reported resultMinimumValue is higher than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualityminimumbelowloq"" = '1'
AND ISNUMERIC(""resultminimumvalue"")
AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultminimumvalue"" AS NUMERIC(32,16))> CAST(""procedureloqvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10b2_logic_belowLOQ_true_mean","Logical coherence test - resultQualityMeanBelowLOQ - True","Tests that there are no records where resultMeanValue > procedureLOQValue if resultQualityMeanBelowLOQ = True.","Although the resultQualityMeanBelowLOQ = True, the reported resultMeanValue is higher than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualitymeanbelowloq"" = '1'
AND ISNUMERIC(""resultmeanvalue"")
AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultmeanvalue"" AS NUMERIC(32,16))> CAST(""procedureloqvalue"" AS NUMERIC(32,16))
","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10b3_logic_belowLOQ_true_maximum","Logical coherence test - resultQualityMaximumBelowLOQ - True","Tests that there are no records where resultMaximumValue > procedureLOQValue if resultQualityMaximumBelowLOQ = True.","Although the resultQualityMaximumBelowLOQ = True, the reported resultMaximumValue is higher than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualitymaximumbelowloq"" = '1'
AND ISNUMERIC(""resultmaximumvalue"")
AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultmaximumvalue"" AS NUMERIC(32,16))> CAST(""procedureloqvalue"" AS NUMERIC(32,16))
","RECORD","BLOCKER","false","true","true"
"AggregatedData","","10b4_logic_belowLOQ_true_median","Logical coherence test - resultQualityMedianBelowLOQ - True","Tests that there are no records where resultMedianValue > procedureLOQValue if resultQualityMedianBelowLOQ = True.","Although the resultQualityMedianBelowLOQ = True, the reported resultMedianValue is higher than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""aggregateddata""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualitymedianbelowloq"" = '1'
  AND ISNUMERIC(""resultmedianvalue"")
  AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultmedianvalue"" AS NUMERIC(32,16))> CAST(""procedureloqvalue"" AS NUMERIC(32,16))
","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10b1_logic_belowLOQ_false_minimum","Logical coherence test - resultQualityMinimumBelowLOQ - False","Tests that there are no records where resultMinimumValue < procedureLOQValue if resultQualityMinimumBelowLOQ = False.","Although the resultQualityMinimumBelowLOQ = False, the reported resultMinimumValue is lower than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualityminimumbelowloq"" = '0'
AND ISNUMERIC(""resultminimumvalue"")
AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultminimumvalue"" AS NUMERIC(32,16))< CAST(""procedureloqvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10b2_logic_belowLOQ_false_mean","Logical coherence test - resultQualityMeanBelowLOQ - False","Tests that there are no records where resultMeanValue < procedureLOQValue if resultQualityMeanBelowLOQ = False.","Although the resultQualityMeanBelowLOQ = False, the reported resultMeanValue is lower than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualitymeanbelowloq"" = '0'
AND ISNUMERIC(""resultmeanvalue"" )
AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultmeanvalue"" AS NUMERIC(32,16)) < CAST(""procedureloqvalue"" AS NUMERIC(32,16))
","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10b3_logic_belowLOQ_false_maximum","Logical coherence test - resultQualityMaximumBelowLOQ - False","Tests that there are no records where resultMaximumValue < procedureLOQValue if resultQualityMaximumBelowLOQ = False.","Although the resultQualityMaximumBelowLOQ = False, the reported resultMaximumValue is lower than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualitymaximumbelowloq"" = '0'
AND ISNUMERIC(""resultmaximumvalue"")
AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultmaximumvalue"" AS NUMERIC(32,16)) < CAST(""procedureloqvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10b4_logic_belowLOQ_false_median","Logical coherence test - resultQualityMedianBelowLOQ - False","Tests that there are no records where resultMedianValue < procedureLOQValue if resultQualityMedianBelowLOQ = False.","Although the resultQualityMedianBelowLOQ = False, the reported resultMedianValue is lower than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualitymedianbelowloq"" = '0'
AND ISNUMERIC(""resultmedianvalue"")
AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultmedianvalue"" AS NUMERIC(32,16))< CAST(""procedureloqvalue"" AS NUMERIC(32,16))
","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10b1_logic_belowLOQ_true_minimum","Logical coherence test - resultQualityMinimumBelowLOQ - True","Tests that there are no records where resultMinimumValue > procedureLOQValue if resultQualityMinimumBelowLOQ = True.","Although the resultQualityMinimumBelowLOQ = True, the reported resultMinimumValue is higher than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualityminimumbelowloq"" = '1'
  AND ISNUMERIC(""resultminimumvalue"")
AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultminimumvalue"" AS NUMERIC(32,16))> CAST(""procedureloqvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10b2_logic_belowLOQ_true_mean","Logical coherence test - resultQualityMeanBelowLOQ - True","Tests that there are no records where resultMeanValue > procedureLOQValue if resultQualityMeanBelowLOQ = True.","Although the resultQualityMeanBelowLOQ = True, the reported resultMeanValue is higher than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualitymeanbelowloq"" = '1'
 AND ISNUMERIC(""resultmeanvalue"")
AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultmeanvalue"" AS NUMERIC(32,16))> CAST(""procedureloqvalue"" AS NUMERIC(32,16))","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10b3_logic_belowLOQ_true_maximum","Logical coherence test - resultQualityMaximumBelowLOQ - True","Tests that there are no records where resultMaximumValue > procedureLOQValue if resultQualityMaximumBelowLOQ = True.","Although the resultQualityMaximumBelowLOQ = True, the reported resultMaximumValue is higher than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualitymaximumbelowloq"" = '1'
  AND ISNUMERIC(""resultmaximumvalue"")
AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultmaximumvalue"" AS NUMERIC(32,16))> CAST(""procedureloqvalue"" AS NUMERIC(32,16))
","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","","10b4_logic_belowLOQ_true_median","Logical coherence test - resultQualityMedianBelowLOQ - True","Tests that there are no records where resultMedianValue > procedureLOQValue if resultQualityMedianBelowLOQ = True.","Although the resultQualityMedianBelowLOQ = True, the reported resultMedianValue is higher than parameterLOQValue.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE COALESCE(""resultobservationstatus"",'') <>'Z'
  AND ""resultqualitymedianbelowloq"" = '1'
  AND ISNUMERIC(""resultmedianvalue"")
  AND ISNUMERIC(""procedureloqvalue"")
  AND CAST(""resultmedianvalue"" AS NUMERIC(32,16))> CAST(""procedureloqvalue"" AS NUMERIC(32,16))

","RECORD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","waterBodyIdentifier","04a_spatialIdentifier_country","Water body identifier test - country code","Tests that the country code part of the waterBodyIdentifier value matches the one of the reporting country.","The waterBodyIdentifier doesn't match the reporting country. It should start with '{%R3_COUNTRY_CODE%}'.","SELECT record_id
  --,'{%R3_COUNTRY_CODE%}' as cc 
FROM dataset_74231.""aggregateddatabywaterbody"" 
WHERE LEFT(""waterbodyidentifier"",2) <> '{%R3_COUNTRY_CODE%}'","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","waterBodyIdentifier","04b_spatialIdentifier_format","Water body identifier test - format","Tests correctness of the spatialUnitIdentifier value format.","The waterBodyIdentifier value has incorrect format.","SELECT record_id
FROM dataset_74231.""aggregateddatabywaterbody""
WHERE NOT REGEXP_MATCHES(""waterbodyidentifier"", '^[A-Z]{2}[0-9A-Z]{1}([0-9A-Z_\-]{0,38}[0-9A-Z]{1}){0,1}$')
   OR NOT REGEXP_MATCHES(""waterbodyidentifier"", '^([A-Z0-9](\-|_)?)+$')","FIELD","BLOCKER","false","true","true"
"AggregatedData","parameterSamplingPeriod","07f2_constraints_parameterSamplingPeriod_dates","Value constraints test - parameterSamplingPeriod - real dates","Tests that in the parameterSamplingPeriod represents real dates.","The parameterSamplingPeriod doesn't represent real dates.","WITH 
per1 AS (
  SELECT *
  FROM dataset_74231.""aggregateddata""
  WHERE ""parametersamplingperiod"" IS NOT NULL AND ""parametersamplingperiod"" <>''
	AND (
     REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
      OR REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}--[0-9]{4}-[0-9]{2}$')
	)
	AND ""resultobservationstatus"" <> 'Z'
)

,perStartEnd AS (
  SELECT SUBSTRING(""parametersamplingperiod"",1,10) AS perStart
    ,SUBSTRING(""parametersamplingperiod"",POSITION('--' IN ""parametersamplingperiod"")+2,10) AS perEnd 
	,*
  FROM per1
  WHERE REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
  UNION
  SELECT concat( SUBSTRING(""parametersamplingperiod"",1,7) , '-01' )AS perStart
	,concat( SUBSTRING(""parametersamplingperiod"",POSITION('--' IN ""parametersamplingperiod"")+2,10) , '-01' ) AS perEnd
	,*
  FROM per1
  WHERE REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
)

SELECT record_id
FROM perStartEnd
WHERE isdate(""perstart"") <> true OR isdate(""perend"") <> true","FIELD","BLOCKER","false","true","true"
"AggregatedData","parameterSamplingPeriod","07f3_constraints_parameterSamplingPeriod_start_end","Value constraints test - parameterSamplingPeriod - start and end date","Tests that in the parameterSamplingPeriod the starting date is not higher than ending date.","The starting date is higher than ending date.","WITH 
per1 AS (
  SELECT *
  FROM dataset_74231.""aggregateddata""
  WHERE ""parametersamplingperiod"" IS NOT NULL
  AND  ""parametersamplingperiod"" <> ''
	AND (
 REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
      OR REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}--[0-9]{4}-[0-9]{2}$')
	)
	AND ""resultobservationstatus"" <> 'Z'
)

,perStartEnd AS (
  SELECT SUBSTRING(""parametersamplingperiod"",1,10) AS perStart
    ,SUBSTRING(""parametersamplingperiod"",POSITION('--' IN ""parametersamplingperiod"")+2,10) AS perEnd 
	,*
  FROM per1
  WHERE 
REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 

  UNION
  SELECT concat( SUBSTRING(""parametersamplingperiod"",1,7) , '-01' )AS perStart
	,concat( SUBSTRING(""parametersamplingperiod"",POSITION('--' IN ""parametersamplingperiod"")+2,10) ,'-01' ) AS perEnd
	,*
  FROM per1
  WHERE REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
)

,perValidDates AS (
	SELECT *
		FROM perStartEnd
		WHERE isdate(""perstart"") = TRUE AND isdate(""perend"") = TRUE
)

SELECT record_id
FROM perValidDates
WHERE CAST(perStart AS date) > CAST(perEnd AS date)","FIELD","BLOCKER","false","true","true"
"AggregatedData","parameterSamplingPeriod","07f4_constraints_parameterSamplingPeriod_length","Value constraints test - parameterSamplingPeriod - period length","Tests that the parameterSamplingPeriod represent a period of maximum one year.","The period is over one year in length.","WITH 
per1 AS (
  SELECT *
  FROM dataset_74231.""aggregateddata""
  WHERE ""parametersamplingperiod"" IS NOT NULL AND  ""parametersamplingperiod""  <>''
	AND (
      REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
      OR REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}--[0-9]{4}-[0-9]{2}$')
 	)
	AND ""resultobservationstatus"" <> 'Z'
)

,perStartEnd AS (
  SELECT SUBSTRING(""parametersamplingperiod"",1,10) AS perStart
    ,SUBSTRING(""parametersamplingperiod"",POSITION('--' IN 
 ""parametersamplingperiod"")+2,10) AS perEnd 
	,*
  FROM per1
  WHERE  REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
  UNION
  SELECT concat( SUBSTRING(""parametersamplingperiod"",1,7) , '-01' ) AS perStart
	,concat(SUBSTRING(""parametersamplingperiod"",POSITION('--' IN ""parametersamplingperiod"")+2,10) , '-01')  AS perEnd
	,*
  FROM per1
  WHERE REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}--[0-9]{4}-[0-9]{2}$')
)

,perValidDates AS (
  SELECT 
   CAST(LEFT(perStart,4) as int) as Y1
	,CAST(LEFT(perEnd,4) as int) as Y2
	,SUBSTRING(perStart,6,2) as M1
	,SUBSTRING(perEnd,6,2) as M2
	,SUBSTRING(perStart,9,2) as D1
	,SUBSTRING(perEnd,9,2) as D2
	, *
  FROM perStartEnd
  WHERE isdate(""perstart"") = TRUE AND isdate(""perend"") = TRUE
)

,perValidStartEnd AS (
  SELECT *
  FROM perValidDates
  WHERE CAST(perStart AS date) > CAST(perEnd AS date)
)

SELECT record_id
FROM perValidStartEnd
WHERE 
  NOT (
    ( Y1=Y2 and ( M1<M2 or ( M1=M2 and D1<=D2 ))) 
	OR ( Y1=Y2-1 and ( M1>M2 or ( M1=M2 and D1>D2 )))
  )","FIELD","BLOCKER","false","true","true"
"AggregatedData","parameterSamplingPeriod","07f5_constraints_parameterSamplingPeriod_year","Value constraints test - parameterSamplingPeriod - reference year match","Tests that the parameterSamplingPeriod matches with the value provided in the phenomenonTimeReferenceYear field.","The parameterSamplingPeriod doesn't match the phenomenonTimeReferenceYear.","WITH 
per1 AS (
  SELECT *
  FROM dataset_74231.""aggregateddata""
  WHERE ""parametersamplingperiod"" IS NOT NULL
AND ""parametersamplingperiod"" <>''
	AND (
    REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
      OR REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}--[0-9]{4}-[0-9]{2}$')
	)
	AND ""resultobservationstatus"" <> 'Z'
)

,perStartEnd AS (
  SELECT SUBSTRING(""parametersamplingperiod"",1,10) AS perStart
    ,SUBSTRING(""parametersamplingperiod"",POSITION('--' IN""parametersamplingperiod"")+2,10) AS perEnd 
	,*
  FROM per1
  WHERE REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
  UNION
  SELECT concat( SUBSTRING(""parametersamplingperiod"",1,7) , '-01' ) AS perStart
	,concat( SUBSTRING(""parametersamplingperiod"",POSITION('--' IN ""parametersamplingperiod"")+2,10) , '-01' ) AS perEnd
	,*
  FROM per1
  WHERE REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}--[0-9]{4}-[0-9]{2}$')
)

,perValidDates AS (
  SELECT 
   CAST(LEFT(perStart,4) as int) as Y1
	,CAST(LEFT(perEnd,4) as int) as Y2
	,SUBSTRING(perStart,6,2) as M1
	,SUBSTRING(perEnd,6,2) as M2
	,SUBSTRING(perStart,9,2) as D1
	,SUBSTRING(perEnd,9,2) as D2
	, *
  FROM perStartEnd
  WHERE isdate(""perstart"") = TRUE AND isdate(""perend"") = TRUE
)

,perValidStartEnd AS (
  SELECT *
  FROM perValidDates
  WHERE CAST(perStart AS date) > CAST(perEnd AS date)
)

SELECT record_id
FROM perValidStartEnd
WHERE  ISNUMERIC(""phenomenontimereferenceyear"" ) and ISNUMERIC(phenomenontimereferenceyear) AND Y1 <> cast(""phenomenontimereferenceyear"" as int)
  AND Y2 <> cast(""phenomenontimereferenceyear"" as int)
","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","parameterSamplingPeriod","07f2_constraints_parameterSamplingPeriod_dates","Value constraints test - parameterSamplingPeriod - real dates","Tests that in the parameterSamplingPeriod represents real dates.","The parameterSamplingPeriod doesn't represent real dates.","WITH 
per1 AS (
  SELECT *
  FROM dataset_74231.""aggregateddatabywaterbody""
  WHERE ""parametersamplingperiod"" IS NOT NULL
AND ""parametersamplingperiod"" <> '' 
	AND (
     REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
      OR REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}--[0-9]{4}-[0-9]{2}$')

	)
	AND ""resultobservationstatus"" <> 'Z'
)

,perStartEnd AS (
  SELECT SUBSTRING(""parametersamplingperiod"",1,10) AS perStart
    ,SUBSTRING(""parametersamplingperiod"",POSITION('--' IN ""parametersamplingperiod"")+2,10) AS perEnd 
	,*
  FROM per1
  WHERE REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
  UNION
  SELECT concat(SUBSTRING(""parametersamplingperiod"",1,7) , '-01' ) AS perStart
	,concat(SUBSTRING(""parametersamplingperiod"",POSITION('--' IN ""parametersamplingperiod"")+2,10) ,'-01' )  AS perEnd
	,*
  FROM per1
  WHERE REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}--[0-9]{4}-[0-9]{2}$')
)

SELECT record_id
FROM perStartEnd
WHERE isdate(""perstart"") <> TRUE OR isdate(""perend"") <> TRUE","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","parameterSamplingPeriod","07f3_constraints_parameterSamplingPeriod_start_end","Value constraints test - parameterSamplingPeriod - start and end date","Tests that in the parameterSamplingPeriod the starting date is not higher than ending date.","The starting date is higher than ending date.","WITH 
per1 AS (
  SELECT *
  FROM dataset_74231.""aggregateddatabywaterbody""
  WHERE ""parametersamplingperiod"" IS NOT NULL
AND ""parametersamplingperiod""<>''
	AND (
     REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
      OR REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}--[0-9]{4}-[0-9]{2}$')

	)
	AND ""resultobservationstatus"" <> 'Z'
)

,perStartEnd AS (
  SELECT SUBSTRING(""parametersamplingperiod"",1,10) AS perStart
    ,SUBSTRING(""parametersamplingperiod"",POSITION('--' IN ""parametersamplingperiod"")+2,10) AS perEnd 
	,*
  FROM per1
  WHERE REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
  UNION
  SELECT concat(SUBSTRING(""parametersamplingperiod"",1,7) , '-01' ) AS perStart
	,concat(SUBSTRING(""parametersamplingperiod"",POSITION('--' IN ""parametersamplingperiod"")+2,10) ,'-01' ) AS perEnd
	,*
  FROM per1
  WHERE REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}--[0-9]{4}-[0-9]{2}$')
)

,perValidDates AS (
	SELECT *
		FROM perStartEnd
		WHERE isdate(""perstart"") = TRUE AND isdate(""perend"") = TRUE
)

SELECT record_id
FROM perValidDates
WHERE CAST(perStart AS date) > CAST(perEnd AS date)","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","parameterSamplingPeriod","07f4_constraints_parameterSamplingPeriod_length","Value constraints test - parameterSamplingPeriod - period length","Tests that the parameterSamplingPeriod represent a period of maximum one year.","The period is over one year in length.","WITH 
per1 AS (
  SELECT *
  FROM dataset_74231.""aggregateddatabywaterbody""
  WHERE ""parametersamplingperiod"" IS NOT NULL
AND ""parametersamplingperiod""<>''
	AND (
     REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
      OR REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}--[0-9]{4}-[0-9]{2}$')

	)
	AND ""resultobservationstatus"" <> 'Z'
)

,perStartEnd AS (
  SELECT SUBSTRING(""parametersamplingperiod"",1,10) AS perStart
    ,SUBSTRING(""parametersamplingperiod"",POSITION('--' IN ""parametersamplingperiod"")+2,10) AS perEnd 
	,*
  FROM per1
  WHERE REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
  UNION
  SELECT concat( SUBSTRING(""parametersamplingperiod"",1,7) , '-01' ) AS perStart
	,concat(SUBSTRING(""parametersamplingperiod"",POSITION('--' IN ""parametersamplingperiod"")+2,10) ,'-01') AS perEnd
	,*
  FROM per1
  WHERE REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}--[0-9]{4}-[0-9]{2}$')
)

,perValidDates AS (
  SELECT 
   CAST(LEFT(perStart,4) as int) as Y1
	,CAST(LEFT(perEnd,4) as int) as Y2
	,SUBSTRING(perStart,6,2) as M1
	,SUBSTRING(perEnd,6,2) as M2
	,SUBSTRING(perStart,9,2) as D1
	,SUBSTRING(perEnd,9,2) as D2
	, *
  FROM perStartEnd
  WHERE isdate(""perstart"") = TRUE AND isdate(""perend"") = TRUE
)

,perValidStartEnd AS (
  SELECT *
  FROM perValidDates
  WHERE CAST(perStart AS date) > CAST(perEnd AS date)
)

SELECT record_id
FROM perValidStartEnd
WHERE 
  NOT (
    ( Y1=Y2 and ( M1<M2 or ( M1=M2 and D1<=D2 ))) 
	OR ( Y1=Y2-1 and ( M1>M2 or ( M1=M2 and D1>D2 )))
  )","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","parameterSamplingPeriod","07f5_constraints_parameterSamplingPeriod_year","Value constraints test - parameterSamplingPeriod - reference year match","Tests that the parameterSamplingPeriod matches with the value provided in the phenomenonTimeReferenceYear field.","The parameterSamplingPeriod doesn't match the phenomenonTimeReferenceYear.","WITH 
per1 AS (
  SELECT *
  FROM dataset_74231.""aggregateddatabywaterbody""
  WHERE ""parametersamplingperiod"" IS NOT NULL
and  ""parametersamplingperiod""<>''
	AND (
     REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
      OR REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}--[0-9]{4}-[0-9]{2}$')
	)
	AND ""resultobservationstatus"" <> 'Z'
)

,perStartEnd AS (
  SELECT SUBSTRING(""parametersamplingperiod"",1,10) AS perStart
    ,SUBSTRING(""parametersamplingperiod"",POSITION('--' IN ""parametersamplingperiod"")+2,10) AS perEnd 
	,*
  FROM per1
  WHERE REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}-[0-9]{2}--[0-9]{4}-[0-9]{2}-[0-9]{2}$') 
  UNION
  SELECT concat(SUBSTRING(""parametersamplingperiod"",1,7) , '-01' ) AS perStart
	,concat(SUBSTRING(""parametersamplingperiod"",POSITION('--' IN ""parametersamplingperiod"")+2,10) ,'-01' ) AS perEnd
	,*
  FROM per1
  WHERE REGEXP_LIKE(""parametersamplingperiod"", '^[0-9]{4}-[0-9]{2}--[0-9]{4}-[0-9]{2}$')
)

,perValidDates AS (
  SELECT 
   CAST(LEFT(perStart,4) as int) as Y1
	,CAST(LEFT(perEnd,4) as int) as Y2
	,SUBSTRING(perStart,6,2) as M1
	,SUBSTRING(perEnd,6,2) as M2
	,SUBSTRING(perStart,9,2) as D1
	,SUBSTRING(perEnd,9,2) as D2
	, *
  FROM perStartEnd
  WHERE isdate(""perstart"") = TRUE AND isdate(""perend"") = TRUE
)

,perValidStartEnd AS (
  SELECT *
  FROM perValidDates
  WHERE CAST(perStart AS date) > CAST(perEnd AS date)
)

SELECT record_id
FROM perValidStartEnd
WHERE ISNUMERIC(""phenomenontimereferenceyear"" ) and ISNUMERIC(phenomenontimereferenceyear) AND Y1 <> cast(""phenomenontimereferenceyear"" as int)
  AND Y2 <> cast(""phenomenontimereferenceyear"" as int)","FIELD","BLOCKER","false","true","true"
"AggregatedData","","TU261","Table type uniqueConstraint","Checks if monitoringSiteIdentifier, monitoringSiteIdentifierScheme, observedPropertyDeterminandCode, procedureAnalysedMatrix, phenomenonTimeReferenceYear and parameterSampleDepth are uniques within table","Uniqueness and multiplicity constraints - The fields monitoringSiteIdentifier, monitoringSiteIdentifierScheme, observedPropertyDeterminandCode, procedureAnalysedMatrix, phenomenonTimeReferenceYear and parameterSampleDepth are uniques within table",,"TABLE","BLOCKER","true","true","true"
"AggregatedData","resultUom","06a_coherence_observedProperty_uom","Coherence test - observedPropertyDeterminandCode and resultUom","Tests that the reported resultUom value is correct for the reported observedPropertyDeterminandCode.","The reported resultUom is not correct for the observedPropertyDeterminandCode. The correct one is '{%correct_uom%}'.","SELECT rep.record_id, refer.resultUom as correct_uom 
FROM dataset_74231.""aggregateddata"" as rep 
INNER JOIN ( 
  SELECT ""observedpropertydeterminandcode"", ""resultuom"" ,""procedureanalysedmatrix"" 
  FROM dataset_74232.""observedproperty_qc_reference"" 
  WHERE tableName = 'AggregatedData' 
) as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE rep.""resultuom"" IS NOT NULL 
  AND rep.""resultuom"" <> '' 
  AND rep.""resultuom"" <> refer.""resultuom""","FIELD","BLOCKER","false","true","true"
"AggregatedDataByWaterBody","resultUom","06a_coherence_observedProperty_uom","Coherence test - observedPropertyDeterminandCode and resultUom","Tests that the reported resultUom value is correct for the reported observedPropertyDeterminandCode.","The reported resultUom is not correct for the observedPropertyDeterminandCode. The correct one is '{%correct_uom%}'.","SELECT rep.record_id, refer.resultUom as correct_uom 
FROM dataset_74231.""aggregateddatabywaterbody"" as rep 
INNER JOIN ( 
  SELECT ""observedpropertydeterminandcode"", ""resultuom"" ,""procedureanalysedmatrix"" 
  FROM dataset_74232.""observedproperty_qc_reference"" 
  WHERE tableName = 'AggregatedDataByWaterBody' 
) as refer 
  ON rep.""observedpropertydeterminandcode"" = refer.""observedpropertydeterminandcode"" 
  AND LEFT(rep.""procedureanalysedmatrix"",1) = refer.""procedureanalysedmatrix"" 
WHERE rep.""resultuom"" IS NOT NULL 
  AND rep.""resultuom"" <> '' 
  AND rep.""resultuom"" <> refer.""resultuom""","FIELD","BLOCKER","false","true","true"
"DisaggregatedData","resultQualityObservedValueBelowLOQ","FT261","Field type CODELIST","Checks if the field is a valid SINGLESELECT_CODELIST","The value is not a valid member of the codelist",,"FIELD","BLOCKER","true","true","true"
